<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>数据迁移 | 大数据知识点集锦</title><meta name="description" content="数据迁移">
    <link rel="modulepreload" href="/assets/app.f67b6590.js"><link rel="modulepreload" href="/assets/index.html.3169f9bb.js"><link rel="modulepreload" href="/assets/index.html.f0aaffe8.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.4f4b7d40.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">大数据知识点集锦</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="大数据架构知识点"><span class="title">大数据架构知识点</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="大数据架构知识点"><span class="title">大数据架构知识点</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>数据湖</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/dataLake" class="" aria-label="数据湖"><!--[--><!--]--> 数据湖 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>大数据架构</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/architecture/lambda.html" class="" aria-label="lambda架构"><!--[--><!--]--> lambda架构 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/architecture/kappa.html" class="" aria-label="kappa架构"><!--[--><!--]--> kappa架构 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="hadoop"><span class="title">hadoop</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="hadoop"><span class="title">hadoop</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>hdfs</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/hadoop/hdfs/hdfsShell.html" class="" aria-label="hdfs Shell命令"><!--[--><!--]--> hdfs Shell命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hadoop/hdfs/distcp.html" class="" aria-label="hdfs distcp命令"><!--[--><!--]--> hdfs distcp命令 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>kafka</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/MQ/kafka/kafkaCommand.html" class="" aria-label="kafka基本命令"><!--[--><!--]--> kafka基本命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/MQ/kafka/sasl/kafkaSaslPlain.html" class="" aria-label="kafka sasl plain认证"><!--[--><!--]--> kafka sasl plain认证 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="sql数据库"><span class="title">sql数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="sql数据库"><span class="title">sql数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>mysql</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sqlDatabase/mysql/mysqlDump.html" class="" aria-label="mysqlDump迁移"><!--[--><!--]--> mysqlDump迁移 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="nosql数据库"><span class="title">nosql数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="nosql数据库"><span class="title">nosql数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>redis</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/redis/redisAOF.html" class="" aria-label="redis AOF"><!--[--><!--]--> redis AOF <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ssdb</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/ssdb/ssdbToredis.html" class="" aria-label="SSDB数据迁移至Redis"><!--[--><!--]--> SSDB数据迁移至Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>impala</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/impala/" class="" aria-label="impala基础入门"><!--[--><!--]--> impala基础入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>kudu</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/kudu/" class="" aria-label="kudu基础入门"><!--[--><!--]--> kudu基础入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="大数据架构知识点"><span class="title">大数据架构知识点</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="大数据架构知识点"><span class="title">大数据架构知识点</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>数据湖</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/dataLake" class="" aria-label="数据湖"><!--[--><!--]--> 数据湖 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>大数据架构</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/architecture/lambda.html" class="" aria-label="lambda架构"><!--[--><!--]--> lambda架构 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/architecture/kappa.html" class="" aria-label="kappa架构"><!--[--><!--]--> kappa架构 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="hadoop"><span class="title">hadoop</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="hadoop"><span class="title">hadoop</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>hdfs</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/hadoop/hdfs/hdfsShell.html" class="" aria-label="hdfs Shell命令"><!--[--><!--]--> hdfs Shell命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hadoop/hdfs/distcp.html" class="" aria-label="hdfs distcp命令"><!--[--><!--]--> hdfs distcp命令 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>kafka</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/MQ/kafka/kafkaCommand.html" class="" aria-label="kafka基本命令"><!--[--><!--]--> kafka基本命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/MQ/kafka/sasl/kafkaSaslPlain.html" class="" aria-label="kafka sasl plain认证"><!--[--><!--]--> kafka sasl plain认证 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="sql数据库"><span class="title">sql数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="sql数据库"><span class="title">sql数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>mysql</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sqlDatabase/mysql/mysqlDump.html" class="" aria-label="mysqlDump迁移"><!--[--><!--]--> mysqlDump迁移 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="nosql数据库"><span class="title">nosql数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="nosql数据库"><span class="title">nosql数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>redis</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/redis/redisAOF.html" class="" aria-label="redis AOF"><!--[--><!--]--> redis AOF <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ssdb</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/ssdb/ssdbToredis.html" class="" aria-label="SSDB数据迁移至Redis"><!--[--><!--]--> SSDB数据迁移至Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>impala</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/impala/" class="" aria-label="impala基础入门"><!--[--><!--]--> impala基础入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>kudu</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/kudu/" class="" aria-label="kudu基础入门"><!--[--><!--]--> kudu基础入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">数据迁移 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/dataMigration/#数据迁移流程梳理" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据迁移流程梳理"><!--[--><!--]--> 数据迁移流程梳理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/dataMigration/#一、迁移前准备工作" class="router-link-active router-link-exact-active sidebar-item" aria-label="一、迁移前准备工作"><!--[--><!--]--> 一、迁移前准备工作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/dataMigration/#二、具体操作梳理" class="router-link-active router-link-exact-active sidebar-item" aria-label="二、具体操作梳理"><!--[--><!--]--> 二、具体操作梳理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/dataMigration/#三、新集群验证" class="router-link-active router-link-exact-active sidebar-item" aria-label="三、新集群验证"><!--[--><!--]--> 三、新集群验证 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="数据迁移流程梳理" tabindex="-1"><a class="header-anchor" href="#数据迁移流程梳理" aria-hidden="true">#</a> 数据迁移流程梳理</h2><h3 id="一、迁移前准备工作" tabindex="-1"><a class="header-anchor" href="#一、迁移前准备工作" aria-hidden="true">#</a> 一、迁移前准备工作</h3><p>第一天：</p><p>①：新环境私有化etl程序、load、paopi程序及定时任务全部关闭,确保环境干净.调整新环境kafka保存时间为30天，只调整sdklua_online即可</p><p>②：①确认无误后通知客户将网关地址指向私有化新环境。</p><p>③：客户切换网关地址后，将老环境数据上传掐掉。等待数据消费完成。同样关闭相应的定时任务</p><p>第二天：</p><p>④确认老环境当天load及跑批是否已经全部完成</p><h3 id="二、具体操作梳理" tabindex="-1"><a class="header-anchor" href="#二、具体操作梳理" aria-hidden="true">#</a> 二、具体操作梳理</h3><h4 id="_2-1-mysql前端库备份-旧环境" tabindex="-1"><a class="header-anchor" href="#_2-1-mysql前端库备份-旧环境" aria-hidden="true">#</a> 2.1. mysql前端库备份（旧环境）</h4><blockquote><p>ps:根据实际情况备份所需要的库</p></blockquote><ul><li><ol><li>导出前端库sdkv</li></ol></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mysqldump --opt sdkv -hweb -uweb -p&#39;zanalytics&#39; &gt; ./sdkv.db
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><ol start="2"><li>导出元数据库hive</li></ol></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mysqldump --opt hive -hweb -uweb -p&#39;zhugeio&#39; &gt; ./hive.db
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>将导出的库文件拷贝至新环境，根据时间情况选择拷贝方式</p></blockquote><h4 id="_2-2-redis数据导出-旧环境" tabindex="-1"><a class="header-anchor" href="#_2-2-redis数据导出-旧环境" aria-hidden="true">#</a> 2.2. REDIS数据导出 （旧环境）</h4><ul><li>web相关</li></ul><blockquote><p>参考文档 https://note.youdao.com/s/Yzty4Vk6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>涉及：26380,26480
将redis的aof拷贝至新环境
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-3-ssdb数据导出-旧环境" tabindex="-1"><a class="header-anchor" href="#_2-3-ssdb数据导出-旧环境" aria-hidden="true">#</a> 2.3. SSDB数据导出（旧环境）</h4><p>*etl:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>涉及：8892,8893,8894,8895,8897<span class="token punctuation">(</span>可清理，无需备份<span class="token punctuation">)</span>,8898
将数据目录直接拷贝至新环境，启动即可
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>ps: 如果需要将ssdb迁移至新环境redis中请参考：https://note.youdao.com/s/KRruQFL4</p></blockquote><ul><li>web:</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token number">8884,8888</span>  <span class="token punctuation">(</span>无需迁移，初始化信息部署时已有<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_2-4-kudu备份-老环境" tabindex="-1"><a class="header-anchor" href="#_2-4-kudu备份-老环境" aria-hidden="true">#</a> 2.4. kudu备份 (老环境)</h4><blockquote><p>ps: https://note.youdao.com/s/5cpakweW</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>将kudu数据备份到hdfs,此操作需要注意以下两点
1.备份的表数量需与原表数量一致
2.备份的表中数据量需与原表数量一致
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-5-hdfs迁移-老环境" tabindex="-1"><a class="header-anchor" href="#_2-5-hdfs迁移-老环境" aria-hidden="true">#</a> 2.5. hdfs迁移 (老环境)</h4><blockquote><p>将老环境hdfs数据导到新环境hdfs,此处方式比较多，目前比较常用的方式如下：</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1. old—hdfs ====&gt; new-hdfs  （推荐）
新旧集群如果是内网或者网络带宽能得到保证的情况下，新旧环境直连拷贝，省掉中间环节。

2. old-hdfs =====&gt;oss====&gt;new-hdfs（常规）
针对客户上云的情况，客户会可能需要通过oss作为中转
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>新旧集群直连拷贝 企查查客户的新旧环境都在内网中，因此使用此方式进行hdfs的迁移</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>nohup hadoop distcp -m 48 -bandwidth 200 /user/hive/warehouse/zhugeio.db/ hdfs://172.18.181.12:8020/user/hive/warehouse/zhugeio.db/  &amp;

内网拷贝数据100M/s, 2.8T数据执行了大约3.5h  

a.执行迁移命令后注意观察日志，注意报错及评估拷贝进度
b.如果执行成功，无异常，请对新旧环境的hdfs数据进行对比 ‘du’
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-6-清理新环境测试应用app-避免appid重复导致的冲突" tabindex="-1"><a class="header-anchor" href="#_2-6-清理新环境测试应用app-避免appid重复导致的冲突" aria-hidden="true">#</a> 2.6. 清理新环境测试应用app，避免appId重复导致的冲突</h4><ul><li>mysql中信息</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.将新环境的mysql中各个库备份
2.备份完成后删除即可，后面需要将旧库导入

mysqldump --opt sdkv -hweb -uweb -p&#39;zanalytics&#39; &gt; ./sdkv—tmp.db
mysqldump --opt hive -hweb -uweb -p&#39;zanalytics&#39; &gt; ./hive—tmp.db

mysql&gt; drop database sdkv;
mysql&gt; drop database hive;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>redis及ssdb</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>将原数据目录清空后重启即可，里面都是测试数据
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_2-7-新环境导入mysql相关库" tabindex="-1"><a class="header-anchor" href="#_2-7-新环境导入mysql相关库" aria-hidden="true">#</a> 2.7. 新环境导入mysql相关库</h4><ul><li>1 导入sdkv库</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>##查看建库语句
&gt;show create database sdkv;

##创建空库sdkv
&gt;CREATE DATABASE `sdkv` /*!40100 DEFAULT CHARACTER SET utf8 */;
##创建web用户
&gt;CREATE USER &#39;web&#39;@&#39;%&#39;;
##授权给web用户
&gt;GRANT ALL ON *.* TO &#39;web&#39;@&#39;%&#39;;
##将老环境sdkv库导入
&gt;use sdkv;
&gt;source /${WORK_DIR}/sdkv.db
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>2 使用打包平台tools工具，修改新环境导入的sdkv表结构。</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>java -jar tools-1.0.jar mysql_sdkv_update.json
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>node sql导入 如果客户的老环境比较旧，更新完sdkv表结构后，node相关表中可能是空的，需导入初始化sql</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sql文件：（tbj:/data/download/secure-patch/realtime-cluster/node）
        DATA_ACCESS.sql
        scene.sql
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><ol start="3"><li>导入其他库（如hive库）</li></ol></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>##创建空库hive
&gt;CREATE DATABASE `hive` /*!40100 DEFAULT CHARACTER SET utf8 */;
##创建web用户
&gt;CREATE USER &#39;hive&#39;@&#39;%&#39;;
##授权给web用户
&gt;GRANT ALL ON *.* TO &#39;hive&#39;@&#39;%&#39;;
##将老环境sdkv库导入
&gt;use hive;
&gt;source /${WORK_DIR}/hive.db
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_2-8-hdfs恢复" tabindex="-1"><a class="header-anchor" href="#_2-8-hdfs恢复" aria-hidden="true">#</a> 2.8 hdfs恢复</h4><blockquote><p>前提：hive库已恢复</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.确认hdfs中数据可通过impala查询
2.通过impala对比新旧仓库中的hdfs表数量及表中数据
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-9-kudu恢复" tabindex="-1"><a class="header-anchor" href="#_2-9-kudu恢复" aria-hidden="true">#</a> 2.9 kudu恢复</h4><blockquote><p>1.前提：hdfs确认无误 2.参考文档：https://note.youdao.com/s/5cpakweW</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kudu恢复后，需要注意表数量及表中数据是否能对上
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_2-10-新环境导入ssdb" tabindex="-1"><a class="header-anchor" href="#_2-10-新环境导入ssdb" aria-hidden="true">#</a> 2.10 新环境导入ssdb</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>基于拷贝目录启动相关ssdb即可
&gt; ps: 如果需要将ssdb迁移至新环境redis中请参考：https://note.youdao.com/s/KRruQFL4
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-11-新环境导入redis" tabindex="-1"><a class="header-anchor" href="#_2-11-新环境导入redis" aria-hidden="true">#</a> 2.11. 新环境导入redis</h4><blockquote><p>参考文档 https://note.youdao.com/s/Yzty4Vk6</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>涉及：26380,26480
将拷贝的 .aof文件导入即可
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="三、新集群验证" tabindex="-1"><a class="header-anchor" href="#三、新集群验证" aria-hidden="true">#</a> 三、新集群验证</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.运维针对恢复后新环境各个模块及功能进行简单测试
2.交付测试
3.配合切换数据上传 （访问地址有变动，都需要打包更新配置）
4.game over
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: yangyunhuang@zhugeio.com">yangyunhuang</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--]--></div>
    <script type="module" src="/assets/app.f67b6590.js" defer></script>
  </body>
</html>
