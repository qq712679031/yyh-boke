<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>kudu基础入门 | 大数据知识点集锦</title><meta name="description" content="kudu基础入门">
    <link rel="modulepreload" href="/assets/app.f67b6590.js"><link rel="modulepreload" href="/assets/index.html.a4da12e5.js"><link rel="modulepreload" href="/assets/index.html.280ab659.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.4f4b7d40.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">大数据知识点集锦</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="大数据架构知识点"><span class="title">大数据架构知识点</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="大数据架构知识点"><span class="title">大数据架构知识点</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>数据湖</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/dataLake" class="" aria-label="数据湖"><!--[--><!--]--> 数据湖 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>大数据架构</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/architecture/lambda.html" class="" aria-label="lambda架构"><!--[--><!--]--> lambda架构 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/architecture/kappa.html" class="" aria-label="kappa架构"><!--[--><!--]--> kappa架构 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="hadoop"><span class="title">hadoop</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="hadoop"><span class="title">hadoop</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>hdfs</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/hadoop/hdfs/hdfsShell.html" class="" aria-label="hdfs Shell命令"><!--[--><!--]--> hdfs Shell命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hadoop/hdfs/distcp.html" class="" aria-label="hdfs distcp命令"><!--[--><!--]--> hdfs distcp命令 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>kafka</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/MQ/kafka/kafkaCommand.html" class="" aria-label="kafka基本命令"><!--[--><!--]--> kafka基本命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/MQ/kafka/sasl/kafkaSaslPlain.html" class="" aria-label="kafka sasl plain认证"><!--[--><!--]--> kafka sasl plain认证 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="sql数据库"><span class="title">sql数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="sql数据库"><span class="title">sql数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>mysql</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sqlDatabase/mysql/mysqlDump.html" class="" aria-label="mysqlDump迁移"><!--[--><!--]--> mysqlDump迁移 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="nosql数据库"><span class="title">nosql数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="nosql数据库"><span class="title">nosql数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>redis</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/redis/redisAOF.html" class="" aria-label="redis AOF"><!--[--><!--]--> redis AOF <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ssdb</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/ssdb/ssdbToredis.html" class="" aria-label="SSDB数据迁移至Redis"><!--[--><!--]--> SSDB数据迁移至Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>impala</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/impala/" class="" aria-label="impala基础入门"><!--[--><!--]--> impala基础入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>kudu</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/noSqlDatabase/kudu/" class="router-link-active router-link-exact-active router-link-active" aria-label="kudu基础入门"><!--[--><!--]--> kudu基础入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="大数据架构知识点"><span class="title">大数据架构知识点</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="大数据架构知识点"><span class="title">大数据架构知识点</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>数据湖</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/dataLake" class="" aria-label="数据湖"><!--[--><!--]--> 数据湖 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>大数据架构</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/architecture/lambda.html" class="" aria-label="lambda架构"><!--[--><!--]--> lambda架构 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/architecture/kappa.html" class="" aria-label="kappa架构"><!--[--><!--]--> kappa架构 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="hadoop"><span class="title">hadoop</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="hadoop"><span class="title">hadoop</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>hdfs</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/hadoop/hdfs/hdfsShell.html" class="" aria-label="hdfs Shell命令"><!--[--><!--]--> hdfs Shell命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hadoop/hdfs/distcp.html" class="" aria-label="hdfs distcp命令"><!--[--><!--]--> hdfs distcp命令 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="消息队列"><span class="title">消息队列</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>kafka</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/MQ/kafka/kafkaCommand.html" class="" aria-label="kafka基本命令"><!--[--><!--]--> kafka基本命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/MQ/kafka/sasl/kafkaSaslPlain.html" class="" aria-label="kafka sasl plain认证"><!--[--><!--]--> kafka sasl plain认证 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="sql数据库"><span class="title">sql数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="sql数据库"><span class="title">sql数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>mysql</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sqlDatabase/mysql/mysqlDump.html" class="" aria-label="mysqlDump迁移"><!--[--><!--]--> mysqlDump迁移 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="nosql数据库"><span class="title">nosql数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="nosql数据库"><span class="title">nosql数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>redis</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/redis/redisAOF.html" class="" aria-label="redis AOF"><!--[--><!--]--> redis AOF <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ssdb</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/ssdb/ssdbToredis.html" class="" aria-label="SSDB数据迁移至Redis"><!--[--><!--]--> SSDB数据迁移至Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>impala</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/noSqlDatabase/impala/" class="" aria-label="impala基础入门"><!--[--><!--]--> impala基础入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>kudu</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/noSqlDatabase/kudu/" class="router-link-active router-link-exact-active router-link-active" aria-label="kudu基础入门"><!--[--><!--]--> kudu基础入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">kudu基础入门 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/noSqlDatabase/kudu/#_1、kudu介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="1、kudu介绍"><!--[--><!--]--> 1、kudu介绍 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/noSqlDatabase/kudu/#_1-1-背景介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 背景介绍"><!--[--><!--]--> 1.1 背景介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_1-2-kudu是什么" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 kudu是什么"><!--[--><!--]--> 1.2 kudu是什么 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_1-3-kudu的应用场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3 kudu的应用场景"><!--[--><!--]--> 1.3 kudu的应用场景 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_2、kudu的架构" class="router-link-active router-link-exact-active sidebar-item" aria-label="2、Kudu的架构"><!--[--><!--]--> 2、Kudu的架构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3、java代码操作kudu" class="router-link-active router-link-exact-active sidebar-item" aria-label="3、java代码操作kudu"><!--[--><!--]--> 3、java代码操作kudu <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3-1-构建maven工程-导入依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 构建maven工程，导入依赖"><!--[--><!--]--> 3.1 构建maven工程，导入依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3-2-初始化方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 初始化方法"><!--[--><!--]--> 3.2 初始化方法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3-3-创建表" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 创建表"><!--[--><!--]--> 3.3 创建表 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3-4-插入数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4 插入数据"><!--[--><!--]--> 3.4 插入数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3-5-查询数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5 查询数据"><!--[--><!--]--> 3.5 查询数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3-6-修改数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6 修改数据"><!--[--><!--]--> 3.6 修改数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3-7-删除数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.7 删除数据"><!--[--><!--]--> 3.7 删除数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3-8-删除表" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.8 删除表"><!--[--><!--]--> 3.8 删除表 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_3-9-kudu的分区方式" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.9 kudu的分区方式"><!--[--><!--]--> 3.9 kudu的分区方式 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_4、spark操作kudu" class="router-link-active router-link-exact-active sidebar-item" aria-label="4、spark操作kudu"><!--[--><!--]--> 4、spark操作kudu <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/noSqlDatabase/kudu/#_4-1-引入依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 引入依赖"><!--[--><!--]--> 4.1 引入依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_4-2-创建表" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 创建表"><!--[--><!--]--> 4.2 创建表 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_4-3-dataframe操作kudu" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 dataFrame操作kudu"><!--[--><!--]--> 4.3 dataFrame操作kudu <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_4-4-kudu-native-rdd" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 Kudu Native RDD"><!--[--><!--]--> 4.4 Kudu Native RDD <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_5、kudu集成impala" class="router-link-active router-link-exact-active sidebar-item" aria-label="5、kudu集成impala"><!--[--><!--]--> 5、kudu集成impala <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/noSqlDatabase/kudu/#_5-1-impala基本介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 impala基本介绍"><!--[--><!--]--> 5.1 impala基本介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_5-2-impala的架构以及查询计划" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 impala的架构以及查询计划"><!--[--><!--]--> 5.2 impala的架构以及查询计划 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_5-3-所有节点配置impala" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3 所有节点配置impala"><!--[--><!--]--> 5.3 所有节点配置impala <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_5-4-将impala与kudu整合" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4 将impala与kudu整合"><!--[--><!--]--> 5.4 将impala与kudu整合 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_6-1-创建kudu表" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.1 创建kudu表"><!--[--><!--]--> 6.1 创建kudu表 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_6-2-使用impala对kudu进行dml操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2 使用impala对kudu进行DML操作"><!--[--><!--]--> 6.2 使用impala对kudu进行DML操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_6-3-更改表属性" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.3 更改表属性"><!--[--><!--]--> 6.3 更改表属性 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_6-4-impala使用java语言操作kudu" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.4 impala使用java语言操作kudu"><!--[--><!--]--> 6.4 impala使用java语言操作kudu <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_7、kudu原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="7、kudu原理"><!--[--><!--]--> 7、kudu原理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/noSqlDatabase/kudu/#_7-1-表与schema" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.1 表与schema"><!--[--><!--]--> 7.1 表与schema <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_7-2-kudu的底层数据模型" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2 kudu的底层数据模型"><!--[--><!--]--> 7.2 kudu的底层数据模型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_7-3-tablet的发现过程" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.3 Tablet的发现过程"><!--[--><!--]--> 7.3 Tablet的发现过程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_7-4-kudu的写流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.4 kudu的写流程"><!--[--><!--]--> 7.4 kudu的写流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_7-5-kudu的读流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.5 kudu的读流程"><!--[--><!--]--> 7.5 kudu的读流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/noSqlDatabase/kudu/#_7-6-kudu的更新流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.6 kudu的更新流程"><!--[--><!--]--> 7.6 kudu的更新流程 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="_1、kudu介绍" tabindex="-1"><a class="header-anchor" href="#_1、kudu介绍" aria-hidden="true">#</a> 1、kudu介绍</h2><h3 id="_1-1-背景介绍" tabindex="-1"><a class="header-anchor" href="#_1-1-背景介绍" aria-hidden="true">#</a> 1.1 背景介绍</h3><p>在KUDU之前，大数据主要以两种方式存储:</p><ol><li><p>静态数据:</p><ul><li>以 HDFS 引擎作为存储引擎，适用于高吞吐量的离线大数据分析场景。</li><li>这类存储的局限性是数据无法进行随机的读写。</li></ul></li><li><p>动态数据:</p><ul><li>以 HBase、Cassandra 作为存储引擎，适用于大数据随机读写场景。</li><li>这类存储的局限性是批量读取吞吐量远不如 HDFS，不适用于批量数据分析的场景。</li></ul></li></ol><p>从上面分析可知，这两种数据在存储方式上完全不同，进而导致使用场景完全不同，但在真实的场景中，边界可能没有那么清晰，面对既需要随机读写，又需要批量分析的大数据场景，该如何选择呢？这个场景中，单种存储引擎无法满足业务需求，我们需要通过多种大数据工具组合来满足这一需求。</p><p><img src="/images/kudu/2717543-04110b9fe00113a6.png" alt="img"></p><p>如上图所示，数据实时写入 HBase，实时的数据更新也在 HBase 完成，为了应对 OLAP 需求，我们定时（通常是 T+1 或者 T+H）将 HBase 数据写成静态的文件（如：Parquet）导入到 OLAP 引擎（如：HDFS）。这一架构能满足既需要随机读写，又可以支持 OLAP 分析的场景，但他有如下缺点：</p><ol><li><p>架构复杂。从架构上看，数据在HBase、消息队列、HDFS 间流转，涉及环节太多，运维成本很高。并且每个环节需要保证高可用，都需要维护多个副本，存储空间也有一定的浪费。最后数据在多个系统上，对数据安全策略、监控等都提出了挑战。</p></li><li><p>时效性低。数据从HBase导出成静态文件是周期性的，一般这个周期是一天（或一小时），在时效性上不是很高。</p></li><li><p>难以应对后续的更新。真实场景中，总会有数据是延迟到达的。如果这些数据之前已经从HBase导出到HDFS，新到的变更数据就难以处理了，一个方案是把原有数据应用上新的变更后重写一遍，但这代价又很高。</p></li></ol><p>为了解决上述架构的这些问题，KUDU应运而生。KUDU的定位是Fast Analytics on Fast Data，是一个既支持随机读写、又支持 OLAP 分析的大数据存储引擎。</p><p><img src="/images/kudu/2717543-5029a91903381b9d.png" alt=""></p><p>从上图可以看出，KUDU 是一个折中的产品，在 HDFS 和 HBase 这两个偏科生中平衡了随机读写和批量分析的性能。从 KUDU 的诞生可以说明一个观点：底层的技术发展很多时候都是上层的业务推动的，脱离业务的技术很可能是空中楼阁。</p><h3 id="_1-2-kudu是什么" tabindex="-1"><a class="header-anchor" href="#_1-2-kudu是什么" aria-hidden="true">#</a> 1.2 kudu是什么</h3><p>Apache Kudu是由Cloudera开源的存储引擎，可以同时提供低延迟的随机读写和高效的数据分析能力。它是一个融合HDFS和HBase的功能的新组件，具备介于两者之间的新存储组件。 Kudu支持水平扩展，并且与Cloudera Impala和Apache Spark等当前流行的大数据查询和分析工具结合紧密。</p><h3 id="_1-3-kudu的应用场景" tabindex="-1"><a class="header-anchor" href="#_1-3-kudu的应用场景" aria-hidden="true">#</a> 1.3 kudu的应用场景</h3><ul><li><p>Strong performance for both scan and random access to help customers simplify complex hybrid architectures（适用于那些既有随机访问，也有批量数据扫描的复合场景）</p></li><li><p>High CPU efficiency in order to maximize the return on investment that our customers are making in modern processors（高计算量的场景）</p></li><li><p>High IO efficiency in order to leverage modern persistent storage（使用了高性能的存储设备，包括使用更多的内存）</p></li><li><p>The ability to update data in place, to avoid extraneous processing and data movement（支持数据更新，避免数据反复迁移）</p></li><li><p>The ability to support active-active replicated clusters that span multiple data centers in geographically distant locations（支持跨地域的实时数据备份和查询）</p></li></ul><p>国内使用的kudu一些案例可以查看《构建近实时分析系统.pdf》文档。</p><h2 id="_2、kudu的架构" tabindex="-1"><a class="header-anchor" href="#_2、kudu的架构" aria-hidden="true">#</a> 2、Kudu的架构</h2><p>与HDFS和HBase相似，Kudu使用单个的Master节点，用来管理集群的元数据，并且使用任意数量的Tablet Server（可对比理解HBase中的RegionServer角色）节点用来存储实际数据。可以部署多个Master节点来提高容错性。一个table表的数据，被分割成1个或多个Tablet，Tablet被部署在Tablet Server来提供数据读写服务。</p><p><img src="/images/kudu/5141839-598de795e2e67284.png" alt=""></p><p>下面是一些基本概念：</p><p>Master:</p><ul><li>集群中的老大，负责集群管理、元数据管理等功能</li></ul><p>Tablet Server</p><ul><li>集群中的小弟，负责数据存储，并提供数据读写服务</li><li>一个 tablet server 存储了table表的tablet 和为 tablet 向 client 提供服务。对于给定的 tablet，一个tablet server 充当 leader，其他 tablet server 充当该 tablet 的 follower 副本。 只有 leader服务写请求，然而 leader 或 followers 为每个服务提供读请求 。一个 tablet server 可以服务多个 tablets ，并且一个 tablet 可以被多个 tablet servers 服务着。</li></ul><p>Table(表):</p><ul><li>一张talbe是数据存储在Kudu的tablet server中。表具有 schema 和全局有序的primary key（主键）。table 被分成称为 tablets 的 segments。</li></ul><p>Tablet:</p><ul><li>一个 tablet 是一张 table连续的segment，tablet是kudu表的水平分区，类似于google Bigtable的tablet，或者HBase的region。每个tablet存储着一定连续range的数据（key），且tablet两两间的range不会重叠。一张表的所有tablet包含了这张表的所有key空间。与其它数据存储引擎或关系型数据库中的 partition（分 区）相似。给定的tablet 冗余到多个 tablet 服务器上，并且在任何给定的时间点，其中一个副本被认为是 leader tablet。任何副本都可以对读取进行服务，并且写入时需要在为 tablet 服务的一组 tablet server之 间达成一致性。</li></ul><h2 id="_3、java代码操作kudu" tabindex="-1"><a class="header-anchor" href="#_3、java代码操作kudu" aria-hidden="true">#</a> 3、java代码操作kudu</h2><h3 id="_3-1-构建maven工程-导入依赖" tabindex="-1"><a class="header-anchor" href="#_3-1-构建maven工程-导入依赖" aria-hidden="true">#</a> 3.1 构建maven工程，导入依赖</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>     
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kudu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-2-初始化方法" tabindex="-1"><a class="header-anchor" href="#_3-2-初始化方法" aria-hidden="true">#</a> 3.2 初始化方法</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestKudu</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义KuduClient客户端对象</span>
     <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">KuduClient</span> kuduClient<span class="token punctuation">;</span>
    <span class="token comment">//定义表名</span>
     <span class="token keyword">private</span> <span class="token keyword">static</span>   <span class="token class-name">String</span> tableName<span class="token operator">=</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 初始化方法
     */</span>
    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//指定master地址</span>
        <span class="token class-name">String</span> masterAddress<span class="token operator">=</span><span class="token string">&quot;node1,node2,node3&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//创建kudu的数据库连接</span>
       kuduClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span>masterAddress<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultSocketReadTimeoutMs</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//构建表schema的字段信息</span>
    								<span class="token comment">//字段名称   数据类型     是否为主键</span>
    <span class="token keyword">public</span> <span class="token class-name">ColumnSchema</span> <span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Type</span> type<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isKey<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ColumnSchema<span class="token punctuation">.</span>ColumnSchemaBuilder</span> column <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ColumnSchema<span class="token punctuation">.</span>ColumnSchemaBuilder</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        column<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>isKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> column<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>  
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_3-3-创建表" tabindex="-1"><a class="header-anchor" href="#_3-3-创建表" aria-hidden="true">#</a> 3.3 创建表</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**  使用junit进行测试
     *	
     * 创建表
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">KuduException</span></span>
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">//设置表的schema</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span> columns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;WorkId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Gender&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Photo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Schema</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>columns<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建表时提供的所有选项</span>
        <span class="token class-name">CreateTableOptions</span> tableOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateTableOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置表的副本和分区规则</span>
        <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置表副本数</span>
        tableOptions<span class="token punctuation">.</span><span class="token function">setNumReplicas</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置range分区</span>
        <span class="token comment">//tableOptions.setRangePartitionColumns(list);</span>
        <span class="token comment">//设置hash分区和分区的数量</span>
        tableOptions<span class="token punctuation">.</span><span class="token function">addHashPartitions</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            kuduClient<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">,</span>schema<span class="token punctuation">,</span>tableOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        kuduClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="_3-4-插入数据" tabindex="-1"><a class="header-anchor" href="#_3-4-插入数据" aria-hidden="true">#</a> 3.4 插入数据</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 向表中加载数据
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">KuduException</span></span>
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">//打开表</span>
        <span class="token class-name">KuduTable</span> kuduTable <span class="token operator">=</span> kuduClient<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建KuduSession对象 kudu必须通过KuduSession写入数据</span>
        <span class="token class-name">KuduSession</span> kuduSession <span class="token operator">=</span> kuduClient<span class="token punctuation">.</span><span class="token function">newSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//采用flush方式 手动刷新</span>
        kuduSession<span class="token punctuation">.</span><span class="token function">setFlushMode</span><span class="token punctuation">(</span><span class="token class-name">SessionConfiguration<span class="token punctuation">.</span>FlushMode</span><span class="token punctuation">.</span>MANUAL_FLUSH<span class="token punctuation">)</span><span class="token punctuation">;</span>
        kuduSession<span class="token punctuation">.</span><span class="token function">setMutationBufferSpace</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//准备数据</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Insert</span> insert <span class="token operator">=</span> kuduTable<span class="token punctuation">.</span><span class="token function">newInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置字段的内容</span>
            insert<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addInt</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            insert<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addInt</span><span class="token punctuation">(</span><span class="token string">&quot;WorkId&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            insert<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lisi&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            insert<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addString</span><span class="token punctuation">(</span><span class="token string">&quot;Gender&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;male&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            insert<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addString</span><span class="token punctuation">(</span><span class="token string">&quot;Photo&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;person&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

            kuduSession<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            kuduSession<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>insert<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        kuduSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kuduClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_3-5-查询数据" tabindex="-1"><a class="header-anchor" href="#_3-5-查询数据" aria-hidden="true">#</a> 3.5 查询数据</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * 查询表数据
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">KuduException</span></span>
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">//打开表</span>
        <span class="token class-name">KuduTable</span> kuduTable <span class="token operator">=</span> kuduClient<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取scanner扫描器</span>
        <span class="token class-name">KuduScanner<span class="token punctuation">.</span>KuduScannerBuilder</span> scannerBuilder <span class="token operator">=</span> kuduClient<span class="token punctuation">.</span><span class="token function">newScannerBuilder</span><span class="token punctuation">(</span>kuduTable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KuduScanner</span> scanner <span class="token operator">=</span> scannerBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//遍历</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">hasMoreRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">RowResultIterator</span> rowResults <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>rowResults<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">RowResult</span> result <span class="token operator">=</span> rowResults<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> companyId <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> workId <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;WorkId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> name <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> gender <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;Gender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> photo <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;Photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;companyId:&quot;</span><span class="token operator">+</span>companyId<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;workId:&quot;</span><span class="token operator">+</span>workId<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;name:&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;gender:&quot;</span><span class="token operator">+</span>gender<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;photo:&quot;</span><span class="token operator">+</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//关闭</span>
        scanner<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kuduClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_3-6-修改数据" tabindex="-1"><a class="header-anchor" href="#_3-6-修改数据" aria-hidden="true">#</a> 3.6 修改数据</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * 修改数据
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">KuduException</span></span>
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">//打开表</span>
        <span class="token class-name">KuduTable</span> kuduTable <span class="token operator">=</span> kuduClient<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//构建kuduSession对象</span>
        <span class="token class-name">KuduSession</span> kuduSession <span class="token operator">=</span> kuduClient<span class="token punctuation">.</span><span class="token function">newSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置刷新数据模式，自动提交</span>
        kuduSession<span class="token punctuation">.</span><span class="token function">setFlushMode</span><span class="token punctuation">(</span><span class="token class-name">SessionConfiguration<span class="token punctuation">.</span>FlushMode</span><span class="token punctuation">.</span>AUTO_FLUSH_BACKGROUND<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//更新数据需要获取Update对象</span>
        <span class="token class-name">Update</span> update <span class="token operator">=</span> kuduTable<span class="token punctuation">.</span><span class="token function">newUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取row对象</span>
        <span class="token class-name">PartialRow</span> row <span class="token operator">=</span> update<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置要更新的数据信息</span>
        row<span class="token punctuation">.</span><span class="token function">addInt</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        row<span class="token punctuation">.</span><span class="token function">addString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;kobe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//操作这个update对象</span>
        kuduSession<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>

        kuduSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_3-7-删除数据" tabindex="-1"><a class="header-anchor" href="#_3-7-删除数据" aria-hidden="true">#</a> 3.7 删除数据</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 删除表中的数据
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">//打开表</span>
        <span class="token class-name">KuduTable</span> kuduTable <span class="token operator">=</span> kuduClient<span class="token punctuation">.</span><span class="token function">openTable</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KuduSession</span> kuduSession <span class="token operator">=</span> kuduClient<span class="token punctuation">.</span><span class="token function">newSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取Delete对象</span>
        <span class="token class-name">Delete</span> delete <span class="token operator">=</span> kuduTable<span class="token punctuation">.</span><span class="token function">newDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//构建要删除的行对象</span>
        <span class="token class-name">PartialRow</span> row <span class="token operator">=</span> delete<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置删除数据的条件</span>
        row<span class="token punctuation">.</span><span class="token function">addInt</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kuduSession<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kuduSession<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>delete<span class="token punctuation">)</span><span class="token punctuation">;</span>
        kuduSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kuduClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_3-8-删除表" tabindex="-1"><a class="header-anchor" href="#_3-8-删除表" aria-hidden="true">#</a> 3.8 删除表</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * 删除表
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">//删除表</span>
        <span class="token class-name">DeleteTableResponse</span> response <span class="token operator">=</span> kuduClient<span class="token punctuation">.</span><span class="token function">deleteTable</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭客户端连接</span>
        kuduClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_3-9-kudu的分区方式" tabindex="-1"><a class="header-anchor" href="#_3-9-kudu的分区方式" aria-hidden="true">#</a> 3.9 kudu的分区方式</h3><p>为了提供可扩展性，Kudu 表被划分为称为 tablets 的单元，并分布在许多 tablet servers 上。行总是属于单个tablet 。将行分配给 tablet 的方法由在表创建期间设置的表的分区决定。 kudu提供了3种分区方式。</p><h4 id="_3-9-1-range-partitioning-范围分区" tabindex="-1"><a class="header-anchor" href="#_3-9-1-range-partitioning-范围分区" aria-hidden="true">#</a> 3.9.1 Range Partitioning ( 范围分区 )</h4><ul><li>范围分区可以根据存入数据的数据量，均衡的存储到各个机器上，防止机器出现负载不均衡现象.</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>   <span class="token doc-comment comment">/**
     * 测试分区：
     * RangePartition
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRangePartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">//设置表的schema</span>
        <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span> columnSchemas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;WorkId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Gender&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Photo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建schema</span>
        <span class="token class-name">Schema</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>columnSchemas<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建表时提供的所有选项</span>
        <span class="token class-name">CreateTableOptions</span> tableOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateTableOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置副本数</span>
        tableOptions<span class="token punctuation">.</span><span class="token function">setNumReplicas</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置范围分区的规则</span>
        <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> parcols <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        parcols<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置按照那个字段进行range分区</span>
        tableOptions<span class="token punctuation">.</span><span class="token function">setRangePartitionColumns</span><span class="token punctuation">(</span>parcols<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * range
         *  0 &lt; value &lt; 10
         * 10 &lt;= value &lt; 20
         * 20 &lt;= value &lt; 30
         * ........
         * 80 &lt;= value &lt; 90
         * */</span>
        <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//范围开始</span>
            <span class="token class-name">PartialRow</span> lower <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">newPartialRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lower<span class="token punctuation">.</span><span class="token function">addInt</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//范围结束</span>
            <span class="token class-name">PartialRow</span> upper <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">newPartialRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            count <span class="token operator">+=</span><span class="token number">10</span><span class="token punctuation">;</span>
            upper<span class="token punctuation">.</span><span class="token function">addInt</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//设置每一个分区的范围</span>
            tableOptions<span class="token punctuation">.</span><span class="token function">addRangePartition</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span>upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            kuduClient<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">,</span>schema<span class="token punctuation">,</span>tableOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KuduException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
         kuduClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h4 id="_3-9-2-hash-partitioning-哈希分区" tabindex="-1"><a class="header-anchor" href="#_3-9-2-hash-partitioning-哈希分区" aria-hidden="true">#</a> 3.9.2 Hash Partitioning ( 哈希分区 )</h4><p>哈希分区通过哈希值将行分配到许多 buckets ( 存储桶 )之一； 哈希分区是一种有效的策略，当不需要对表进行有序访问时。哈希分区对于在 tablet 之间随机散布这些功能是有效的，这有助于减轻热点和 tablet 大小不均匀。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * 测试分区：
     * hash分区
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHashPartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">//设置表的schema</span>
        <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span> columnSchemas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;WorkId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Gender&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Photo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建schema</span>
        <span class="token class-name">Schema</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>columnSchemas<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建表时提供的所有选项</span>
        <span class="token class-name">CreateTableOptions</span> tableOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateTableOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置副本数</span>
        tableOptions<span class="token punctuation">.</span><span class="token function">setNumReplicas</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置范围分区的规则</span>
        <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> parcols <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        parcols<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置按照那个字段进行range分区</span>
        tableOptions<span class="token punctuation">.</span><span class="token function">addHashPartitions</span><span class="token punctuation">(</span>parcols<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            kuduClient<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&quot;dog&quot;</span><span class="token punctuation">,</span>schema<span class="token punctuation">,</span>tableOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KuduException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        kuduClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="_3-9-3-multilevel-partitioning-多级分区" tabindex="-1"><a class="header-anchor" href="#_3-9-3-multilevel-partitioning-多级分区" aria-hidden="true">#</a> 3.9.3 Multilevel Partitioning ( 多级分区 )</h4><p>Kudu 允许一个表在单个表上组合多级分区。 当正确使用时，多级分区可以保留各个分区类型的优点，同时减少每个分区的缺点 需求.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * 测试分区：
     * 多级分区
     * Multilevel Partition
     * 混合使用hash分区和range分区
     *
     * 哈希分区有利于提高写入数据的吞吐量，而范围分区可以避免tablet无限增长问题，
     * hash分区和range分区结合，可以极大的提升kudu的性能
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMultilevelPartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">//设置表的schema</span>
        <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span> columnSchemas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;WorkId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Gender&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columnSchemas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Photo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建schema</span>
        <span class="token class-name">Schema</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>columnSchemas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建表时提供的所有选项</span>
        <span class="token class-name">CreateTableOptions</span> tableOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateTableOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置副本数</span>
        tableOptions<span class="token punctuation">.</span><span class="token function">setNumReplicas</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置范围分区的规则</span>
        <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> parcols <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        parcols<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//hash分区</span>
        tableOptions<span class="token punctuation">.</span><span class="token function">addHashPartitions</span><span class="token punctuation">(</span>parcols<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//range分区</span>
        <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">PartialRow</span> lower <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">newPartialRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lower<span class="token punctuation">.</span><span class="token function">addInt</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            count<span class="token operator">+=</span><span class="token number">10</span><span class="token punctuation">;</span>

            <span class="token class-name">PartialRow</span> upper <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">newPartialRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            upper<span class="token punctuation">.</span><span class="token function">addInt</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tableOptions<span class="token punctuation">.</span><span class="token function">addRangePartition</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span>upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            kuduClient<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&quot;cat&quot;</span><span class="token punctuation">,</span>schema<span class="token punctuation">,</span>tableOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KuduException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        kuduClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h2 id="_4、spark操作kudu" tabindex="-1"><a class="header-anchor" href="#_4、spark操作kudu" aria-hidden="true">#</a> 4、spark操作kudu</h2><ul><li>Spark与KUDU集成支持： <ul><li>DDL操作（创建/删除）</li><li>本地Kudu RDD</li><li>Native Kudu数据源，用于DataFrame集成</li><li>从kudu读取数据</li><li>从Kudu执行插入/更新/ upsert /删除</li><li>谓词下推</li><li>Kudu和Spark SQL之间的模式映射</li><li>到目前为止，我们已经听说过几个上下文，例如SparkContext，SQLContext，HiveContext， SparkSession，现在，我们将使用Kudu引入一个KuduContext。这是可在Spark应用程序中广播的主要可序列化对象。此类代表在Spark执行程序中与Kudu Java客户端进行交互。 KuduContext提供执行DDL操作所需的方法，与本机Kudu RDD的接口，对数据执行更新/插入/删除，将数据类型从Kudu转换为Spark等。</li></ul></li></ul><h3 id="_4-1-引入依赖" tabindex="-1"><a class="header-anchor" href="#_4-1-引入依赖" aria-hidden="true">#</a> 4.1 引入依赖</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>       

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kudu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-client-tools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.6.0-cdh5.14.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kudu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.6.0-cdh5.14.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.kudu/kudu-spark2 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kudu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kudu-spark2_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.6.0-cdh5.14.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.spark/spark-sql --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-sql_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_4-2-创建表" tabindex="-1"><a class="header-anchor" href="#_4-2-创建表" aria-hidden="true">#</a> 4.2 创建表</h3><ul><li><p>定义kudu的表需要分成5个步骤：</p><ol><li>提供表名</li><li>提供schema</li><li>提供主键</li><li>定义重要选项；例如：定义分区的schema</li><li>调用create Table api</li></ol></li><li><p>代码开发</p></li></ul><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">object</span> SparkKuduTest <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//构建sparkConf对象</span>
     <span class="token keyword">val</span> sparkConf<span class="token operator">:</span> SparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;SparkKuduTest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[2]&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">//构建SparkSession对象</span>
    <span class="token keyword">val</span> sparkSession<span class="token operator">:</span> SparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>config<span class="token punctuation">(</span>sparkConf<span class="token punctuation">)</span><span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">//获取sparkContext对象</span>
      <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>sparkContext
      sc<span class="token punctuation">.</span>setLogLevel<span class="token punctuation">(</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">)</span>
   
    <span class="token comment">//构建KuduContext对象</span>
      <span class="token keyword">val</span> kuduContext <span class="token operator">=</span> <span class="token keyword">new</span> KuduContext<span class="token punctuation">(</span><span class="token string">&quot;node1:7051,node2:7051,node3:7051&quot;</span><span class="token punctuation">,</span>sc<span class="token punctuation">)</span>

    <span class="token comment">//1.创建表操作</span>
    createTable<span class="token punctuation">(</span>kuduContext<span class="token punctuation">)</span>
    
    <span class="token comment">/**
    * 创建表
    * @param kuduContext
    * @return
    */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> createTable<span class="token punctuation">(</span>kuduContext<span class="token operator">:</span> KuduContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>

    <span class="token comment">//1.1定义表名</span>
    <span class="token keyword">val</span> tableName <span class="token operator">=</span> <span class="token string">&quot;spark_kudu&quot;</span>

    <span class="token comment">//1.2 定义表的schema</span>
    <span class="token keyword">val</span> schema <span class="token operator">=</span> StructType<span class="token punctuation">(</span>
        StructField<span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">::</span>
        StructField<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">::</span>
        StructField<span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">::</span>
        StructField<span class="token punctuation">(</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">::</span> Nil<span class="token punctuation">)</span>

    <span class="token comment">//1.3 定义表的主键</span>
    <span class="token keyword">val</span> primaryKey <span class="token operator">=</span> Seq<span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">//1.4 定义分区的schema</span>
    <span class="token keyword">val</span> options <span class="token operator">=</span> <span class="token keyword">new</span> CreateTableOptions
    <span class="token comment">//设置分区</span>
    options<span class="token punctuation">.</span>setRangePartitionColumns<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asJava<span class="token punctuation">)</span>
    <span class="token comment">//设置副本</span>
    options<span class="token punctuation">.</span>setNumReplicas<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment">//1.5 创建表</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>kuduContext<span class="token punctuation">.</span>tableExists<span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      kuduContext<span class="token punctuation">.</span>createTable<span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> primaryKey<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
  
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>定义表时要注意的是Kudu表选项值。你会注意到在指定组成范围分区列的列名列表时我们调用“asJava”方 法。这是因为在这里，我们调用了Kudu Java客户端本身，它需要Java对象（即java.util.List）而不是Scala的List对 象；（要使“asJava”方法可用，请记住导入JavaConverters库。） 创建表后，通过将浏览器指向http// master主机名:8051/tables</p><p>来查看Kudu主UI可以找到创建的表，通过单击表ID，能够看到表模式和分区信息。</p><p><img src="/images/kudu/1550729068964.png" alt="1550729068964"></p><p>点击Table id 可以观察到表的schema等信息：</p><p><img src="/images/kudu/1550729141209.png" alt="1550729141209"></p><h3 id="_4-3-dataframe操作kudu" tabindex="-1"><a class="header-anchor" href="#_4-3-dataframe操作kudu" aria-hidden="true">#</a> 4.3 dataFrame操作kudu</h3><h4 id="_4-3-1-dml操作" tabindex="-1"><a class="header-anchor" href="#_4-3-1-dml操作" aria-hidden="true">#</a> 4.3.1 DML操作</h4><p>Kudu支持许多DML类型的操作，其中一些操作包含在Spark on Kudu集成. 包括：</p><ul><li>INSERT - 将DataFrame的行插入Kudu表。请注意，虽然API完全支持INSERT，但不鼓励在Spark中使用它。 使用INSERT是有风险的，因为Spark任务可能需要重新执行，这意味着可能要求再次插入已插入的行。这样 做会导致失败，因为如果行已经存在，INSERT将不允许插入行（导致失败）。相反，我们鼓励使用下面描述 的INSERT_IGNORE。</li><li>INSERT-IGNORE - 将DataFrame的行插入Kudu表。如果表存在，则忽略插入动作。</li><li>DELETE - 从Kudu表中删除DataFrame中的行</li><li>UPSERT - 如果存在，则在Kudu表中更新DataFrame中的行，否则执行插入操作。</li><li>UPDATE - 更新dataframe中的行</li></ul><h5 id="_4-3-1-1-插入数据insert操作" tabindex="-1"><a class="header-anchor" href="#_4-3-1-1-插入数据insert操作" aria-hidden="true">#</a> 4.3.1.1 插入数据insert操作</h5><ul><li><p>1、先创建一张表，然后把数据插入到表中</p><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">case</span> <span class="token keyword">class</span> People<span class="token punctuation">(</span>id<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token builtin">String</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">)</span>
<span class="token keyword">object</span> DataFrameKudu <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">//构建SparkConf对象</span>
     <span class="token keyword">val</span> sparkConf<span class="token operator">:</span> SparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;DataFrameKudu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[2]&quot;</span><span class="token punctuation">)</span>
     <span class="token comment">//构建SparkSession对象</span>
     <span class="token keyword">val</span> sparkSession<span class="token operator">:</span> SparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>config<span class="token punctuation">(</span>sparkConf<span class="token punctuation">)</span><span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token comment">//获取SparkContext对象</span>
     <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>sparkContext
    sc<span class="token punctuation">.</span>setLogLevel<span class="token punctuation">(</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">//指定kudu的master地址</span>
     <span class="token keyword">val</span> kuduMaster<span class="token operator">=</span><span class="token string">&quot;node1:7051,node2:7051,node3:7051&quot;</span>
      <span class="token comment">//构建KuduContext对象</span>
     <span class="token keyword">val</span> kuduContext <span class="token operator">=</span> <span class="token keyword">new</span> KuduContext<span class="token punctuation">(</span>kuduMaster<span class="token punctuation">,</span>sc<span class="token punctuation">)</span>
     
       <span class="token comment">//定义表名</span>
       <span class="token keyword">val</span> tableName<span class="token operator">=</span><span class="token string">&quot;people&quot;</span>
       <span class="token comment">//1、创建表</span>
      createTable<span class="token punctuation">(</span>kuduContext<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span>
      
      <span class="token comment">//2、插入数据到表中</span>
    insertData2table<span class="token punctuation">(</span>sparkSession<span class="token punctuation">,</span>sc<span class="token punctuation">,</span> kuduContext<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span>
      
  <span class="token punctuation">}</span>
    
 <span class="token comment">/**
    * 创建表
    * @param kuduContext
    * @param tableName
    */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> createTable<span class="token punctuation">(</span>kuduContext<span class="token operator">:</span> KuduContext<span class="token punctuation">,</span> tableName<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义表的schema</span>
    <span class="token keyword">val</span> schema <span class="token operator">=</span> StructType<span class="token punctuation">(</span>
        StructField<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">::</span>
        StructField<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">::</span>
        StructField<span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">::</span> Nil
    <span class="token punctuation">)</span>

    <span class="token comment">//定义表的主键</span>
    <span class="token keyword">val</span> tablePrimaryKey <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">//定义表的选项配置</span>
    <span class="token keyword">val</span> options <span class="token operator">=</span> <span class="token keyword">new</span> CreateTableOptions
    options<span class="token punctuation">.</span>setRangePartitionColumns<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asJava<span class="token punctuation">)</span>
    options<span class="token punctuation">.</span>setNumReplicas<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment">//创建表</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>kuduContext<span class="token punctuation">.</span>tableExists<span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      kuduContext<span class="token punctuation">.</span>createTable<span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> tablePrimaryKey<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> 
    
      <span class="token comment">/**
    * 插入数据到表中
    * @param sparkSession
    * @param sc
    * @param kuduContext
    * @param tableName
    */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> insertData2table<span class="token punctuation">(</span>sparkSession<span class="token operator">:</span>SparkSession<span class="token punctuation">,</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">,</span> kuduContext<span class="token operator">:</span> KuduContext<span class="token punctuation">,</span> tableName<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//准备数据</span>
    <span class="token keyword">val</span> data <span class="token operator">=</span> List<span class="token punctuation">(</span>People<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> People<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> People<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;wangwu&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> peopleRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span>People<span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">import</span> <span class="token namespace">sparkSession<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    <span class="token keyword">val</span> peopleDF<span class="token operator">:</span> DataFrame <span class="token operator">=</span> peopleRDD<span class="token punctuation">.</span>toDF
    kuduContext<span class="token punctuation">.</span>insertRows<span class="token punctuation">(</span>peopleDF<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span>


  <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
     

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div></li></ul><h5 id="_4-3-1-2-删除数据delete操作" tabindex="-1"><a class="header-anchor" href="#_4-3-1-2-删除数据delete操作" aria-hidden="true">#</a> 4.3.1.2 删除数据delete操作</h5><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code>  <span class="token comment">/**
    * 删除表的数据
    * @param sparkSession
    * @param sc
    * @param kuduMaster
    * @param kuduContext
    * @param tableName
    */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> deleteData<span class="token punctuation">(</span>sparkSession<span class="token operator">:</span> SparkSession<span class="token punctuation">,</span> sc<span class="token operator">:</span> SparkContext<span class="token punctuation">,</span> kuduMaster<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> kuduContext<span class="token operator">:</span> KuduContext<span class="token punctuation">,</span> tableName<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义一个map集合，封装kudu的相关信息</span>
    <span class="token keyword">val</span> options <span class="token operator">=</span> Map<span class="token punctuation">(</span>
      <span class="token string">&quot;kudu.master&quot;</span> <span class="token operator">-&gt;</span> kuduMaster<span class="token punctuation">,</span>
      <span class="token string">&quot;kudu.table&quot;</span> <span class="token operator">-&gt;</span> tableName
    <span class="token punctuation">)</span>

    <span class="token keyword">import</span> <span class="token namespace">sparkSession<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    <span class="token keyword">val</span> data <span class="token operator">=</span> List<span class="token punctuation">(</span>People<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> People<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> People<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;wangwu&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> dataFrame<span class="token operator">:</span> DataFrame <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>toDF
    dataFrame<span class="token punctuation">.</span>createTempView<span class="token punctuation">(</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//获取年龄大于30的所有用户id</span>
    <span class="token keyword">val</span> result<span class="token operator">:</span> DataFrame <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">&quot;select id from temp where age &gt;30&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//删除对应的数据，这里必须要是主键字段</span>
    kuduContext<span class="token punctuation">.</span>deleteRows<span class="token punctuation">(</span>result<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
	
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h5 id="_4-3-1-3-更新数据upsert操作" tabindex="-1"><a class="header-anchor" href="#_4-3-1-3-更新数据upsert操作" aria-hidden="true">#</a> 4.3.1.3 更新数据upsert操作</h5><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code> <span class="token comment">/**
    * 更新数据--添加数据
    *
    * @param sc
    * @param kuduMaster
    * @param kuduContext
    * @param tableName
    */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> UpsertData<span class="token punctuation">(</span>sparkSession<span class="token operator">:</span> SparkSession<span class="token punctuation">,</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">,</span> kuduMaster<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> kuduContext<span class="token operator">:</span> KuduContext<span class="token punctuation">,</span> tableName<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//更新表中的数据</span>
    <span class="token comment">//定义一个map集合，封装kudu的相关信息</span>
    <span class="token keyword">val</span> options <span class="token operator">=</span> Map<span class="token punctuation">(</span>
      <span class="token string">&quot;kudu.master&quot;</span> <span class="token operator">-&gt;</span> kuduMaster<span class="token punctuation">,</span>
      <span class="token string">&quot;kudu.table&quot;</span> <span class="token operator">-&gt;</span> tableName
    <span class="token punctuation">)</span>

    <span class="token keyword">import</span> <span class="token namespace">sparkSession<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    <span class="token keyword">val</span> data <span class="token operator">=</span> List<span class="token punctuation">(</span>People<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> People<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> dataFrame<span class="token operator">:</span> DataFrame <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>toDF
    <span class="token comment">//如果存在就是更新，否则就是插入</span>
    kuduContext<span class="token punctuation">.</span>upsertRows<span class="token punctuation">(</span>dataFrame<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="_4-3-1-4-更新数据update操作" tabindex="-1"><a class="header-anchor" href="#_4-3-1-4-更新数据update操作" aria-hidden="true">#</a> 4.3.1.4 更新数据update操作</h5><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code>  <span class="token comment">/**
    * 更新数据
    * @param sparkSession
    * @param sc
    * @param kuduMaster
    * @param kuduContext
    * @param tableName
    */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> updateData<span class="token punctuation">(</span>sparkSession<span class="token operator">:</span> SparkSession<span class="token punctuation">,</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">,</span> kuduMaster<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> kuduContext<span class="token operator">:</span> KuduContext<span class="token punctuation">,</span> tableName<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义一个map集合，封装kudu的相关信息</span>
    <span class="token keyword">val</span> options <span class="token operator">=</span> Map<span class="token punctuation">(</span>
      <span class="token string">&quot;kudu.master&quot;</span> <span class="token operator">-&gt;</span> kuduMaster<span class="token punctuation">,</span>
      <span class="token string">&quot;kudu.table&quot;</span> <span class="token operator">-&gt;</span> tableName
    <span class="token punctuation">)</span>

    <span class="token keyword">import</span> <span class="token namespace">sparkSession<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    <span class="token keyword">val</span> data <span class="token operator">=</span> List<span class="token punctuation">(</span>People<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> People<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> dataFrame<span class="token operator">:</span> DataFrame <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>toDF
    <span class="token comment">//如果存在就是更新，否则就是报错</span>
    kuduContext<span class="token punctuation">.</span>updateRows<span class="token punctuation">(</span>dataFrame<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="_4-3-2-dataframeapi读取kudu表中的数据" tabindex="-1"><a class="header-anchor" href="#_4-3-2-dataframeapi读取kudu表中的数据" aria-hidden="true">#</a> 4.3.2 DataFrameApi读取kudu表中的数据</h4><p>虽然我们可以通过上面显示的KuduContext执行大量操作，但我们还可以直接从默认数据源本身调用读/写API。要设置读取，我们需要为Kudu表指定选项，命名我们要读取的表以及为表提供服务的Kudu集群的Kudu主服务器列表。</p><ul><li>代码示例</li></ul><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code>  <span class="token comment">/**
    * 使用DataFrameApi读取kudu表中的数据
    * @param sparkSession
    * @param kuduMaster
    * @param tableName
    */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> getTableData<span class="token punctuation">(</span>sparkSession<span class="token operator">:</span> SparkSession<span class="token punctuation">,</span> kuduMaster<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> tableName<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
     <span class="token comment">//定义map集合，封装kudu的master地址和要读取的表名</span>
    <span class="token keyword">val</span> options <span class="token operator">=</span> Map<span class="token punctuation">(</span>
      <span class="token string">&quot;kudu.master&quot;</span> <span class="token operator">-&gt;</span> kuduMaster<span class="token punctuation">,</span>
      <span class="token string">&quot;kudu.table&quot;</span> <span class="token operator">-&gt;</span> tableName
    <span class="token punctuation">)</span>
    sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>options<span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span>kudu<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_4-3-3-dataframeapi写数据到kudu表中" tabindex="-1"><a class="header-anchor" href="#_4-3-3-dataframeapi写数据到kudu表中" aria-hidden="true">#</a> 4.3.3 DataFrameApi写数据到kudu表中</h4><p>在通过DataFrame API编写时，目前只支持一种模式“append”。尚未实现的“覆盖”模式。</p><ul><li>代码示例</li></ul><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code>  <span class="token comment">/**
    * DataFrame api 写数据到kudu表
    * @param sparkSession
    * @param sc
    * @param kuduMaster
    * @param tableName
    */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> dataFrame2kudu<span class="token punctuation">(</span>sparkSession<span class="token operator">:</span> SparkSession<span class="token punctuation">,</span> sc<span class="token operator">:</span> SparkContext<span class="token punctuation">,</span> kuduMaster<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> tableName<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token comment">//定义map集合，封装kudu的master地址和要读取的表名</span>
    <span class="token keyword">val</span> options <span class="token operator">=</span> Map<span class="token punctuation">(</span>
      <span class="token string">&quot;kudu.master&quot;</span> <span class="token operator">-&gt;</span> kuduMaster<span class="token punctuation">,</span>
      <span class="token string">&quot;kudu.table&quot;</span> <span class="token operator">-&gt;</span> tableName
    <span class="token punctuation">)</span>
    <span class="token keyword">val</span> data <span class="token operator">=</span> List<span class="token punctuation">(</span>People<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">&quot;jim&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> People<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&quot;xiaoming&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> <span class="token namespace">sparkSession<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    <span class="token keyword">val</span> dataFrame<span class="token operator">:</span> DataFrame <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>toDF
    <span class="token comment">//把dataFrame结果写入到kudu表中  ,目前只支持append追加</span>
    dataFrame<span class="token punctuation">.</span>write<span class="token punctuation">.</span>options<span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token string">&quot;append&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>kudu

    <span class="token comment">//查看结果</span>
    <span class="token comment">//导包</span>
    <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kudu<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>kudu<span class="token punctuation">.</span></span>_
   <span class="token comment">//加载表的数据，导包调用kudu方法，转换为dataFrame，最后在使用show方法显示结果</span>
   sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>options<span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span>kudu<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="_4-3-4-使用sparksql操作kudu表" tabindex="-1"><a class="header-anchor" href="#_4-3-4-使用sparksql操作kudu表" aria-hidden="true">#</a> 4.3.4 使用sparksql操作kudu表</h4><p>可以选择使用Spark SQL直接使用INSERT语句写入Kudu表；与&#39;append&#39;类似，INSERT语句实际上将默认使用 UPSERT语义处理；</p><ul><li>代码示例</li></ul><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">/**
    * 使用sparksql操作kudu表
    * @param sparkSession
    * @param sc
    * @param kuduMaster
    * @param tableName
    */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> SparkSql2Kudu<span class="token punctuation">(</span>sparkSession<span class="token operator">:</span> SparkSession<span class="token punctuation">,</span> sc<span class="token operator">:</span> SparkContext<span class="token punctuation">,</span> kuduMaster<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> tableName<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token comment">//定义map集合，封装kudu的master地址和表名</span>
    <span class="token keyword">val</span> options <span class="token operator">=</span> Map<span class="token punctuation">(</span>
      <span class="token string">&quot;kudu.master&quot;</span> <span class="token operator">-&gt;</span> kuduMaster<span class="token punctuation">,</span>
      <span class="token string">&quot;kudu.table&quot;</span> <span class="token operator">-&gt;</span> tableName
    <span class="token punctuation">)</span>
    <span class="token keyword">val</span> data <span class="token operator">=</span> List<span class="token punctuation">(</span>People<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&quot;小张&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> People<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">&quot;小王&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> <span class="token namespace">sparkSession<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    <span class="token keyword">val</span> dataFrame<span class="token operator">:</span> DataFrame <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>toDF
      <span class="token comment">//把dataFrame注册成一张表</span>
    dataFrame<span class="token punctuation">.</span>createTempView<span class="token punctuation">(</span><span class="token string">&quot;temp1&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">//获取kudu表中的数据，然后注册成一张表</span>
    sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>options<span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span>kudu<span class="token punctuation">.</span>createTempView<span class="token punctuation">(</span><span class="token string">&quot;temp2&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">//使用sparkSQL的insert操作插入数据</span>
    sparkSession<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">&quot;insert into table temp2 select * from temp1&quot;</span><span class="token punctuation">)</span>
    sparkSession<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">&quot;select * from temp2 where age &gt;30&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_4-4-kudu-native-rdd" tabindex="-1"><a class="header-anchor" href="#_4-4-kudu-native-rdd" aria-hidden="true">#</a> 4.4 Kudu Native RDD</h3><p>Spark与Kudu的集成同时提供了kudu RDD.</p><ul><li>代码示例</li></ul><div class="language-scala ext-scala line-numbers-mode"><pre class="language-scala"><code>    <span class="token comment">//使用kuduContext对象调用kuduRDD方法，需要sparkContext对象，表名，想要的字段名称</span>
   <span class="token keyword">val</span> kuduRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span>Row<span class="token punctuation">]</span> <span class="token operator">=</span> kuduContext<span class="token punctuation">.</span>kuduRDD<span class="token punctuation">(</span>sc<span class="token punctuation">,</span>tableName<span class="token punctuation">,</span>Seq<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//操作该rdd 打印输出</span>
    <span class="token keyword">val</span> result<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> kuduRDD<span class="token punctuation">.</span>map <span class="token punctuation">{</span>
      <span class="token keyword">case</span> Row<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    result<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_5、kudu集成impala" tabindex="-1"><a class="header-anchor" href="#_5、kudu集成impala" aria-hidden="true">#</a> 5、kudu集成impala</h2><h3 id="_5-1-impala基本介绍" tabindex="-1"><a class="header-anchor" href="#_5-1-impala基本介绍" aria-hidden="true">#</a> 5.1 impala基本介绍</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	impala是cloudera提供的一款高效率的sql查询工具，提供实时的查询效果，官方测试性能比hive快10到100倍，其sql查询比sparkSQL还要更加快速，号称是当前大数据领域最快的查询sql工具，


	impala是参照谷歌的新三篇论文（Caffeine--网络搜索引擎、Pregel--分布式图计算、Dremel--交互式分析工具）当中的Dremel实现而来，其中旧三篇论文分别是（BigTable，GFS，MapReduce）分别对应我们即将学的HBase和已经学过的HDFS以及MapReduce。

    impala是基于hive并使用内存进行计算，兼顾数据仓库，具有实时，批处理，多并发等优点	
    
     Kudu与Apache Impala （孵化）紧密集成，impala天然就支持兼容kudu，允许开发人员使用Impala的SQL语法从Kudu的tablets 插入，查询，更新和删除数据；

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_5-2-impala的架构以及查询计划" tabindex="-1"><a class="header-anchor" href="#_5-2-impala的架构以及查询计划" aria-hidden="true">#</a> 5.2 <strong>impala的架构</strong>以及查询计划</h3><p><img src="/images/kudu/20171105084851619.png" alt=""></p><ul><li><p>Impalad</p><ul><li><p>基本是每个DataNode上都会启动一个Impalad进程，Impalad主要扮演两个角色：</p><ul><li><p>Coordinator：</p><ul><li>负责接收客户端发来的查询，解析查询，构建查询计划</li><li>把查询子任务分发给很多Executor，收集Executor返回的结果，组合后返回给客户端</li><li>对于客户端发送来的DDL，提交给Catalogd处理</li></ul></li><li><p>Executor：</p><ul><li>执行查询子任务，将子任务结果返回给Coordinator</li></ul></li></ul></li></ul></li><li><p>Catalogd</p><ul><li>整个集群只有一个Catalogd，负责所有元数据的更新和获取</li></ul></li><li><p>StateStored</p><ul><li>整个集群只有一个Statestored，作为集群的订阅中心，负责集群不同组件的信息同步</li><li>跟踪集群中的Impalad的健康状态及位置信息，由statestored进程表示，它通过创建多个线程来处理Impalad的注册订阅和与各Impalad保持心跳连接，各Impalad都会缓存一份State Store中的信息，当State Store离线后（Impalad发现State Store处于离线时，会进入recovery模式，反复注册，当State Store重新加入集群后，自动恢复正常，更新缓存数据）因为Impalad有State Store的缓存仍然可以工作，但会因为有些Impalad失效了，而已缓存数据无法更新，导致把执行计划分配给了失效的Impalad，导致查询失败。</li></ul></li></ul><h3 id="_5-3-所有节点配置impala" tabindex="-1"><a class="header-anchor" href="#_5-3-所有节点配置impala" aria-hidden="true">#</a> 5.3 所有节点配置impala</h3><h4 id="_5-3-1-修改hive-site-xml文件" tabindex="-1"><a class="header-anchor" href="#_5-3-1-修改hive-site-xml文件" aria-hidden="true">#</a> 5.3.1 修改hive-site.xml文件</h4><ul><li><p>impala依赖于hive，所以首先需要进行hive的配置修改；</p><ul><li><p>node1机器修改hive-site.xml内容如下:</p></li><li><p>vim /export/servers/hive-1.1.0-cdh5.14.0/conf/hive-site.xml</p></li></ul></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
        &lt;value&gt;jdbc:mysql://node1:3306/hive?
        createDatabaseIfNotExist=true&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
        &lt;value&gt;root&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
        &lt;value&gt;123456&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hive.cli.print.current.db&lt;/name&gt;
        &lt;value&gt;true&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hive.cli.print.header&lt;/name&gt;
        &lt;value&gt;true&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;
        &lt;value&gt;node1&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hive.metastore.uris&lt;/name&gt;
        &lt;value&gt;thrift://node1:9083&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hive.metastore.client.socket.timeout&lt;/name&gt;
        &lt;value&gt;3600&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h4 id="_5-3-2-添加mysql的jar包放入hive的lib目录下" tabindex="-1"><a class="header-anchor" href="#_5-3-2-添加mysql的jar包放入hive的lib目录下" aria-hidden="true">#</a> 5.3.2 添加mysql的jar包放入hive的lib目录下</h4><p><img src="/images/kudu/mysql.png" alt=""></p><h4 id="_5-3-3-将hive的安装包发送到node2与node3上" tabindex="-1"><a class="header-anchor" href="#_5-3-3-将hive的安装包发送到node2与node3上" aria-hidden="true">#</a> 5.3.3 将hive的安装包发送到node2与node3上</h4><ul><li>在node1上执行命令</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /export/servers/
scp -r hive-1.1.0-cdh5.14.0/ node2:$PWD
scp -r hive-1.1.0-cdh5.14.0/ node3:$PWD
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_5-3-4-启动hive的metastore服务" tabindex="-1"><a class="header-anchor" href="#_5-3-4-启动hive的metastore服务" aria-hidden="true">#</a> 5.3.4 启动hive的metastore服务</h4><ul><li><p>在node1上启动hive的metastore服务</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /export/servers/hive-1.1.0-cdh5.14.0
nohup bin/hive --service metastore &amp;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>注意：一定要保证mysql的服务正常启动，否则metastore的服务不能够启动</p></li></ul><h4 id="_5-3-5-所有hadoop节点修改hdfs-site-xml添加以下内容" tabindex="-1"><a class="header-anchor" href="#_5-3-5-所有hadoop节点修改hdfs-site-xml添加以下内容" aria-hidden="true">#</a> 5.3.5 所有hadoop节点修改hdfs-site.xml添加以下内容</h4><ul><li>所有节点创建文件夹 <ul><li>mkdir -p /var/run/hdfs-sockets</li></ul></li><li>修改所有节点的hdfs-site.xml添加以下配置，修改完之后重启hdfs集群生效 vim /export/servers/hadoop-2.6.0-cdh5.14.0/etc/hadoop/hdfs-site.xml</li></ul><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>     
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.replication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.permissions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.blocksize<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>134217728<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    
   		<span class="token comment">&lt;!--短路读取--就是允许impala把一些信息存储在本地磁盘上，可以加快计算的速度--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.client.read.shortcircuit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
         
          <span class="token comment">&lt;!--打开块位置的存储的元数据信息--&gt;</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.datanode.hdfs-blocks-metadata.enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    
    	 <span class="token comment">&lt;!--Datanode和DFSClient之间沟通的Socket的本地文件路径--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.domain.socket.path<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/var/run/hdfs-sockets/dn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--分布式文件系统中并行RPC的超时--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.client.file-block-storage-locations.timeout.millis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>10000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h4 id="_5-3-6-重启hdfs" tabindex="-1"><a class="header-anchor" href="#_5-3-6-重启hdfs" aria-hidden="true">#</a> 5.3.6 重启hdfs</h4><ul><li>在hadoop集群的主节点node1上执行 <ul><li>stop-dfs.sh</li><li>start-dfs.sh</li></ul></li></ul><h4 id="_5-3-7-创建hadoop与hive的配置文件的连接" tabindex="-1"><a class="header-anchor" href="#_5-3-7-创建hadoop与hive的配置文件的连接" aria-hidden="true">#</a> 5.3.7 创建hadoop与hive的配置文件的连接</h4><ul><li>impala的配置目录为 /etc/impala/conf <ul><li>这个路径下面需要把core-site.xml，hdfs-site.xml以及hive-site.xml拷贝到这里来，但是我们这里使用软连接的方式会更好。</li><li>所有节点执行以下命令创建链接到impala配置目录下来</li></ul></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ln -s /export/servers/hadoop-2.6.0-cdh5.14.0/etc/hadoop/core-site.xml /etc/impala/conf/core-site.xml

ln -s /export/servers/hadoop-2.6.0-cdh5.14.0/etc/hadoop/hdfs-site.xml  /etc/impala/conf/hdfs-site.xml

    ln -s /export/servers/hive-1.1.0-cdh5.14.0/conf/hive-site.xml /etc/impala/conf/hive-site.xml
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-3-8-所有节点修改impala默认配置" tabindex="-1"><a class="header-anchor" href="#_5-3-8-所有节点修改impala默认配置" aria-hidden="true">#</a> 5.3.8 所有节点修改impala默认配置</h4><ul><li><p>所有节点更改impala默认配置文件以及添加mysql的连接驱动包</p></li><li><p>vim /etc/default/impala</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#指定集群的CATALOG_SERVICE和STATE_STORE服务地址
IMPALA_CATALOG_SERVICE_HOST=node3
IMPALA_STATE_STORE_HOST=node3
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul><h4 id="_5-3-9-所有节点创建mysql的驱动包的软连接" tabindex="-1"><a class="header-anchor" href="#_5-3-9-所有节点创建mysql的驱动包的软连接" aria-hidden="true">#</a> 5.3.9 所有节点创建mysql的驱动包的软连接</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ln -s /export/servers/hive-1.1.0-cdh5.14.0/lib/mysql-connector-java-5.1.35.jar /usr/share/java/mysql-connector-java.jar
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_5-3-10-所有节点修改bigtop的java路径" tabindex="-1"><a class="header-anchor" href="#_5-3-10-所有节点修改bigtop的java路径" aria-hidden="true">#</a> 5.3.10 所有节点修改bigtop的java路径</h4><ul><li><p>修改bigtop的java_home路径</p><ul><li><p>vim /etc/default/bigtop-utils</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>export JAVA_HOME=/export/servers/jdk
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li></ul></li></ul><h4 id="_5-3-11-启动impala服务" tabindex="-1"><a class="header-anchor" href="#_5-3-11-启动impala服务" aria-hidden="true">#</a> 5.3.11 启动impala服务</h4><ul><li><p>在主节点node3启动以下三个服务进程</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service impala-state-store start
service impala-catalog start
service impala-server start
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>在从节点node1和node2上启动impala-server</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>service impala-server start
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>查看impala进程是否存在</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ps -ef | grep impala
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li></ul><p><img src="/images/kudu/1550735579716.png" alt=""></p><p>注意：启动之后所有关于impala的日志默认都在/var/log/impala 这个路径下，node3机器上面应该有三个进 程，node1与node2机器上面只有一个进程，如果进程个数不对，去对应目录下查看报错日志</p><h4 id="_5-3-12-浏览器页面访问" tabindex="-1"><a class="header-anchor" href="#_5-3-12-浏览器页面访问" aria-hidden="true">#</a> 5.3.12 浏览器页面访问</h4><ul><li><p>访问impalad的管理界面http://node3:25000/</p><p><img src="/images/kudu/1550735908605.png" alt=""></p></li><li><p>访问statestored的管理界面http://node3:25010/</p><p>​ <img src="/images/kudu/1550735957214.png" alt=""></p></li><li><p>访问catalogd 的管理界面http://node3:25020/</p><p><img src="/images/kudu/1550736004673.png" alt=""></p></li></ul><h3 id="_5-4-将impala与kudu整合" tabindex="-1"><a class="header-anchor" href="#_5-4-将impala与kudu整合" aria-hidden="true">#</a> 5.4 将impala与kudu整合</h3><ul><li><p>在每一个服务器的impala的配置文件中添加如下配置：</p><ul><li>vim /etc/default/impala</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>在IMPALA_SERVER_ARGS下添加：
-kudu_master_hosts=node1:7051,node2:7051,node3:7051
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如下图：</p><p><img src="/images/kudu/1550752420061.png" alt=""></p></li></ul><h1 id="_6、使用impala操作kudu整合" tabindex="-1"><a class="header-anchor" href="#_6、使用impala操作kudu整合" aria-hidden="true">#</a> 6、使用impala操作kudu整合</h1><ul><li><p>1、需要先启动hdfs、hive、kudu、impala</p></li><li><p>2、使用impala的shell控制台</p><ul><li>执行命令impala-shell</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>(1):使用该impala-shell命令启动Impala Shell 。默认情况下，impala-shell 尝试连接到localhost端口21000 上的Impala守护程序。要连接到其他主机，请使用该-i &lt;host:port&gt;选项。要自动连接到特定的Impala数据库，请使用该-d &lt;database&gt;选项。例如，如果您的所有Kudu表都位于数据库中的Impala中impala_kudu，则-d impala_kudu可以使用此数据库。
(2)：要退出Impala Shell，请使用以下命令： quit;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/images/kudu/1550752818836.png" alt=""></p></li></ul><h3 id="_6-1-创建kudu表" tabindex="-1"><a class="header-anchor" href="#_6-1-创建kudu表" aria-hidden="true">#</a> 6.1 创建kudu表</h3><ul><li>使用Impala创建新的Kudu表时，可以将该表创建为内部表或外部表。</li></ul><h4 id="_6-1-1-内部表" tabindex="-1"><a class="header-anchor" href="#_6-1-1-内部表" aria-hidden="true">#</a> 6.1.1 内部表</h4><ul><li><p>内部表由Impala管理，当您从Impala中删除时，数据和表确实被删除。当您使用Impala创建新表时，它通常是内部表。</p><ul><li>使用impala创建内部表：</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> my_first_table
<span class="token punctuation">(</span>
id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
name STRING<span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span> PARTITIONS <span class="token number">16</span> 
STORED <span class="token keyword">AS</span> KUDU
TBLPROPERTIES <span class="token punctuation">(</span>
<span class="token string">&#39;kudu.master_addresses&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;node1:7051,node2:7051,node3:7051&#39;</span><span class="token punctuation">,</span>
<span class="token string">&#39;kudu.table_name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;my_first_table&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
在 <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 语句中，必须首先列出构成主键的列。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>此时创建的表是内部表，从impala删除表的时候，在底层存储的kudu也会删除表。</li></ul></li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> my_first_table<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_6-1-2-外部表" tabindex="-1"><a class="header-anchor" href="#_6-1-2-外部表" aria-hidden="true">#</a> 6.1.2 外部表</h4><ul><li>外部表（创建者CREATE EXTERNAL TABLE）不受Impala管理，并且删除此表不会将表从其源位置（此处为Kudu）丢弃。相反，它只会去除Impala和Kudu之间的映射。这是Kudu提供的用于将现有表映射到Impala的语法。</li><li>使用java创建一个kudu表： <ul><li>代码</li></ul></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateTable</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ColumnSchema</span> <span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Type</span> type<span class="token punctuation">,</span> <span class="token keyword">boolean</span> iskey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ColumnSchema<span class="token punctuation">.</span>ColumnSchemaBuilder</span> column <span class="token operator">=</span> <span class="token keyword">new</span>
                    <span class="token class-name">ColumnSchema<span class="token punctuation">.</span>ColumnSchemaBuilder</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
                column<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>iskey<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> column<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KuduException</span> <span class="token punctuation">{</span>
        <span class="token comment">// master地址</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> masteraddr <span class="token operator">=</span> <span class="token string">&quot;node1,node2,node3&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建kudu的数据库链接</span>
        <span class="token class-name">KuduClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span>
     <span class="token class-name">KuduClient<span class="token punctuation">.</span>KuduClientBuilder</span><span class="token punctuation">(</span>masteraddr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultSocketReadTimeoutMs</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 设置表的schema</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span> columns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ColumnSchema</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;WorkId&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INT32<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Gender&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        columns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">newColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Photo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Schema</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>columns<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建表时提供的所有选项</span>
    <span class="token class-name">CreateTableOptions</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateTableOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token comment">// 设置表的replica备份和分区规则</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> parcols <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    parcols<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;CompanyId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置表的备份数</span>
        options<span class="token punctuation">.</span><span class="token function">setNumReplicas</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置range分区</span>
    options<span class="token punctuation">.</span><span class="token function">setRangePartitionColumns</span><span class="token punctuation">(</span>parcols<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token comment">//设置hash分区和数量</span>
    options<span class="token punctuation">.</span><span class="token function">addHashPartitions</span><span class="token punctuation">(</span>parcols<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">,</span> schema<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KuduException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><ul><li>在kudu的页面上可以观察到如下信息：</li></ul><p><img src="/images/kudu/1550753915817.png" alt=""></p><ul><li><p>在impala的命令行查看表:</p><p><img src="/images/kudu/1550754009417.png" alt="1550754009417"></p><ul><li>当前在impala中并没有person这个表</li></ul></li><li><p>使用impala创建外部表 ， 将kudu的表映射到impala上：</p><ul><li>在impala-shell执行</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>person<span class="token punctuation">`</span></span> STORED <span class="token keyword">AS</span> KUDU
TBLPROPERTIES<span class="token punctuation">(</span>
    <span class="token string">&#39;kudu.table_name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;person&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;kudu.master_addresses&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;node1:7051,node2:7051,node3:7051&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/images/kudu/1550754186128.png" alt=""></p></li></ul><h3 id="_6-2-使用impala对kudu进行dml操作" tabindex="-1"><a class="header-anchor" href="#_6-2-使用impala对kudu进行dml操作" aria-hidden="true">#</a> 6.2 使用impala对kudu进行DML操作</h3><h4 id="_6-2-1-将数据插入-kudu-表" tabindex="-1"><a class="header-anchor" href="#_6-2-1-将数据插入-kudu-表" aria-hidden="true">#</a> 6.2.1 将数据插入 Kudu 表</h4><ul><li>impala 允许使用标准 SQL 语句将数据插入 Kudu 。</li></ul><h5 id="_6-2-1-1-插入单个值" tabindex="-1"><a class="header-anchor" href="#_6-2-1-1-插入单个值" aria-hidden="true">#</a> 6.2.1.1 插入单个值</h5><ul><li><p>创建表</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> my_first_table1
<span class="token punctuation">(</span>
id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
name STRING<span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span> PARTITIONS <span class="token number">16</span>
STORED <span class="token keyword">AS</span> KUDU 
TBLPROPERTIES<span class="token punctuation">(</span>
    <span class="token string">&#39;kudu.table_name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;person1&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;kudu.master_addresses&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;node1:7051,node2:7051,node3:7051&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li><p>此示例插入单个行</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> my_first_table <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>查看数据</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> my_first_table
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="/images/kudu/1550755125688.png" alt=""></p></li><li><p>使用单个语句插入三行</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> my_first_table <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;john&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;jane&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;jim&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="/images/kudu/1550755323970.png" alt=""></p></li></ul><h5 id="_6-2-1-2-批量插入batch-insert" tabindex="-1"><a class="header-anchor" href="#_6-2-1-2-批量插入batch-insert" aria-hidden="true">#</a> 6.2.1.2 批量插入Batch Insert</h5><ul><li><p>从 Impala 和 Kudu 的角度来看，通常表现最好的方法通常是使用 Impala 中的 SELECT FROM 语句导入数据</p><ul><li>示例</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> my_first_table
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> temp1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul><h4 id="_6-2-2-更新数据" tabindex="-1"><a class="header-anchor" href="#_6-2-2-更新数据" aria-hidden="true">#</a> 6.2.2 更新数据</h4><ul><li><p>示例</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> my_first_table <span class="token keyword">SET</span> name<span class="token operator">=</span><span class="token string">&quot;xiaowang&quot;</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="/images/kudu/1550755633332.png" alt=""></p></li></ul><h4 id="_6-2-3-删除数据" tabindex="-1"><a class="header-anchor" href="#_6-2-3-删除数据" aria-hidden="true">#</a> 6.2.3 删除数据</h4><ul><li><p>示例</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> my_first_table <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="/images/kudu/1550755737020.png" alt=""></p></li></ul><h3 id="_6-3-更改表属性" tabindex="-1"><a class="header-anchor" href="#_6-3-更改表属性" aria-hidden="true">#</a> 6.3 更改表属性</h3><ul><li>开发人员可以通过更改表的属性来更改 Impala 与给定 Kudu 表相关的元数据。这些属性包括表名， Kudu 主地址列表，以及表是否由 Impala （内部）或外部管理。</li></ul><h4 id="_6-3-1-rename-an-impala-mapping-table-重命名-impala-映射表" tabindex="-1"><a class="header-anchor" href="#_6-3-1-rename-an-impala-mapping-table-重命名-impala-映射表" aria-hidden="true">#</a> 6.3.1 Rename an Impala Mapping Table ( 重命名 Impala 映射表 )</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> PERSON <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> person_temp<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="/images/kudu/1550755938064.png" alt=""></p><h4 id="_6-3-2-rename-the-underlying-kudu-table-for-an-internal-table-重" tabindex="-1"><a class="header-anchor" href="#_6-3-2-rename-the-underlying-kudu-table-for-an-internal-table-重" aria-hidden="true">#</a> 6.3.2 Rename the underlying Kudu table for an internal table ( 重</h4><p>新命名内部表的基础 Kudu 表 )</p><ul><li><p>创建内部表：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> kudu_student
<span class="token punctuation">(</span>
CompanyId <span class="token keyword">INT</span><span class="token punctuation">,</span>
WorkId <span class="token keyword">INT</span><span class="token punctuation">,</span>
Name STRING<span class="token punctuation">,</span>
Gender STRING<span class="token punctuation">,</span>
Photo STRING<span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>CompanyId<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span> PARTITIONS <span class="token number">16</span>
STORED <span class="token keyword">AS</span> KUDU
TBLPROPERTIES <span class="token punctuation">(</span>
<span class="token string">&#39;kudu.master_addresses&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;node1:7051,node2:7051,node3:7051&#39;</span><span class="token punctuation">,</span>
<span class="token string">&#39;kudu.table_name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;student&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li><li><p>如果表是内部表，则可以通过更改 kudu.table_name 属性重命名底层的 Kudu 表</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> kudu_student <span class="token keyword">SET</span> TBLPROPERTIES<span class="token punctuation">(</span><span class="token string">&#39;kudu.table_name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;new_student&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><p>效果图</p><p><img src="/images/kudu/1550756387835.png" alt=""></p></li></ul></li></ul><h4 id="_6-3-3-remapping-an-external-table-to-a-different-kudu-table-将外部表重新映射到不同的-kudu-表" tabindex="-1"><a class="header-anchor" href="#_6-3-3-remapping-an-external-table-to-a-different-kudu-table-将外部表重新映射到不同的-kudu-表" aria-hidden="true">#</a> 6.3.3 Remapping an external table to a different Kudu table ( 将外部表重新映射到不同的 Kudu 表 )</h4><ul><li><p>如果用户在使用过程中发现其他应用程序重新命名了kudu表，那么此时的外部表需要重新映射到kudu上</p><ul><li>创建一个外部表：</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> external_table
    STORED <span class="token keyword">AS</span> KUDU
    TBLPROPERTIES <span class="token punctuation">(</span>
    <span class="token string">&#39;kudu.master_addresses&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;node1:7051,node2:7051,node3:7051&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;kudu.table_name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;person&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>重新映射外部表，指向不同的kudu表：</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> external_table
<span class="token keyword">SET</span> TBLPROPERTIES<span class="token punctuation">(</span><span class="token string">&#39;kudu.table_name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;hashTable&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上面的操作是：将external_table映射的PERSON表重新指向hashTable表</p></li></ul><h4 id="_6-3-4-change-the-kudu-master-address-更改-kudu-master-地址" tabindex="-1"><a class="header-anchor" href="#_6-3-4-change-the-kudu-master-address-更改-kudu-master-地址" aria-hidden="true">#</a> 6.3.4 Change the Kudu Master Address ( 更改 Kudu Master 地址 )</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ALTER TABLE my_table
SET TBLPROPERTIES(&#39;kudu.master_addresses&#39; = &#39;kudu-new-master.example.com:7051&#39;);
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_6-3-5-change-an-internally-managed-table-to-external-将内部管理" tabindex="-1"><a class="header-anchor" href="#_6-3-5-change-an-internally-managed-table-to-external-将内部管理" aria-hidden="true">#</a> 6.3.5 Change an Internally-Managed Table to External ( 将内部管理</h4><p>的表更改为外部 )</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ALTER TABLE my_table SET TBLPROPERTIES(&#39;EXTERNAL&#39; = &#39;TRUE&#39;);
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_6-4-impala使用java语言操作kudu" tabindex="-1"><a class="header-anchor" href="#_6-4-impala使用java语言操作kudu" aria-hidden="true">#</a> 6.4 impala使用java语言操作kudu</h3><ul><li>对于impala而言，开发人员是可以通过JDBC连接impala的，有了JDBC，开发人员可以通过impala来间接操作 kudu；</li></ul><h4 id="_6-4-1-引入依赖" tabindex="-1"><a class="header-anchor" href="#_6-4-1-引入依赖" aria-hidden="true">#</a> 6.4.1 引入依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>       <span class="token comment">&lt;!--impala的jdbc操作--&gt;</span> 
	   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ImpalaJDBC41<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.42<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--Caused by : ClassNotFound : thrift.protocol.TPro--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.thrift<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>libfb303<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--Caused by : ClassNotFound : thrift.protocol.TPro--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.thrift<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>libthrift<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
       
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-service-rpc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-service<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--导入hive--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hive-service<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h4 id="_6-4-2-通过jdbc连接impala操作kudu" tabindex="-1"><a class="header-anchor" href="#_6-4-2-通过jdbc连接impala操作kudu" aria-hidden="true">#</a> 6.4.2 通过JDBC连接impala操作kudu</h4><ul><li>使用JDBC连接impala操作kudu，与JDBC连接mysql做更重增删改查基本一样</li></ul><h5 id="_6-4-2-1-创建实体类" tabindex="-1"><a class="header-anchor" href="#_6-4-2-1-创建实体类" aria-hidden="true">#</a> 6.4.2.1 创建实体类</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>impala<span class="token punctuation">.</span>impala</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> companyId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> workId<span class="token punctuation">;</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> gender<span class="token punctuation">;</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> photo<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token keyword">int</span> companyId<span class="token punctuation">,</span> <span class="token keyword">int</span> workId<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> gender<span class="token punctuation">,</span> <span class="token class-name">String</span> photo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>companyId <span class="token operator">=</span> companyId<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>workId <span class="token operator">=</span> workId<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> gender<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>photo <span class="token operator">=</span> photo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> companyId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompanyId</span><span class="token punctuation">(</span><span class="token keyword">int</span> companyId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>companyId <span class="token operator">=</span> companyId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getWorkId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> workId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWorkId</span><span class="token punctuation">(</span><span class="token keyword">int</span> workId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>workId <span class="token operator">=</span> workId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> gender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGender</span><span class="token punctuation">(</span><span class="token class-name">String</span> gender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> gender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> photo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPhoto</span><span class="token punctuation">(</span><span class="token class-name">String</span> photo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>photo <span class="token operator">=</span> photo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h5 id="_6-4-2-2-jdbc连接impala对kudu进行增删改查" tabindex="-1"><a class="header-anchor" href="#_6-4-2-2-jdbc连接impala对kudu进行增删改查" aria-hidden="true">#</a> 6.4.2.2 JDBC连接impala对kudu进行增删改查</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>impala<span class="token punctuation">.</span>impala</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Contants</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> JDBC_DRIVER<span class="token operator">=</span><span class="token string">&quot;com.cloudera.impala.jdbc41.Driver&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span>  <span class="token class-name">String</span> CONNECTION_URL<span class="token operator">=</span><span class="token string">&quot;jdbc:impala://node1:21050/default;auth=noSasl&quot;</span><span class="token punctuation">;</span>
     <span class="token comment">//定义数据库连接</span>
    <span class="token keyword">static</span> <span class="token class-name">Connection</span> conn<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//定义PreparedStatement对象</span>
    <span class="token keyword">static</span> <span class="token class-name">PreparedStatement</span> ps<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//定义查询的结果集</span>
    <span class="token keyword">static</span> <span class="token class-name">ResultSet</span> rs<span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>


    <span class="token comment">//数据库连接</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>JDBC_DRIVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
            conn<span class="token operator">=</span><span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>CONNECTION_URL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span>  conn<span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span>

    <span class="token comment">//创建一个表</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        conn<span class="token operator">=</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;CREATE TABLE impala_kudu_test&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;(&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;companyId BIGINT,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;workId BIGINT,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;name STRING,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;gender STRING,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;photo STRING,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;PRIMARY KEY(companyId)&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;)&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;PARTITION BY HASH PARTITIONS 16 &quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;STORED AS KUDU &quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;TBLPROPERTIES (&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;&#39;kudu.master_addresses&#39; = &#39;node1:7051,node2:7051,node3:7051&#39;,&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;&#39;kudu.table_name&#39; = &#39;impala_kudu_test&#39;&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;);&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            ps <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//查询数据</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultSet</span> <span class="token function">queryRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//定义执行的sql语句</span>
            <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;select * from impala_kudu_test&quot;</span><span class="token punctuation">;</span>
            ps <span class="token operator">=</span> <span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            rs<span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span>  rs<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//打印结果</span>
    <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printRows</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         private int companyId;
         private int workId;
         private  String name;
         private  String gender;
         private  String photo;
         */</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//获取表的每一行字段信息</span>
                <span class="token keyword">int</span> companyId <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;companyId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> workId <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;workId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> name <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> gender <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> photo <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;companyId:&quot;</span><span class="token operator">+</span>companyId<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;workId:&quot;</span><span class="token operator">+</span>workId<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;name:&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;gender:&quot;</span><span class="token operator">+</span>gender<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;photo:&quot;</span><span class="token operator">+</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ps<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    ps<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//插入数据</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">insertRows</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span><span class="token punctuation">{</span>
        conn<span class="token operator">=</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;insert into table impala_kudu_test(companyId,workId,name,gender,photo) values(?,?,?,?,?)&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            ps<span class="token operator">=</span>conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//给占位符？赋值</span>
            ps<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>person<span class="token punctuation">.</span><span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>person<span class="token punctuation">.</span><span class="token function">getWorkId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>person<span class="token punctuation">.</span><span class="token function">getGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>person<span class="token punctuation">.</span><span class="token function">getPhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ps <span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">//关闭</span>
                    ps<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                      <span class="token comment">//关闭</span>
                    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//更新数据</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">updateRows</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token comment">//定义执行的sql语句</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;update impala_kudu_test set workId=&quot;</span><span class="token operator">+</span>person<span class="token punctuation">.</span><span class="token function">getWorkId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>
                <span class="token string">&quot;,name=&#39;&quot;</span><span class="token operator">+</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&#39; ,&quot;</span><span class="token operator">+</span><span class="token string">&quot;gender=&#39;&quot;</span><span class="token operator">+</span>person<span class="token punctuation">.</span><span class="token function">getGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&#39; ,&quot;</span><span class="token operator">+</span>
                <span class="token string">&quot;photo=&#39;&quot;</span><span class="token operator">+</span>person<span class="token punctuation">.</span><span class="token function">getPhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&#39; where companyId=&quot;</span><span class="token operator">+</span>person<span class="token punctuation">.</span><span class="token function">getCompanyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            ps<span class="token operator">=</span> <span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ps <span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                      <span class="token comment">//关闭</span>
                    ps<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                      <span class="token comment">//关闭</span>
                    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//删除数据</span>
    <span class="token keyword">public</span>   <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deleteRows</span><span class="token punctuation">(</span><span class="token keyword">int</span> companyId<span class="token punctuation">)</span><span class="token punctuation">{</span>
      
        <span class="token comment">//定义sql语句</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;delete from impala_kudu_test where companyId=&quot;</span><span class="token operator">+</span>companyId<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            ps <span class="token operator">=</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    
   <span class="token comment">//删除表</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;drop table if exists impala_kudu_test&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            ps <span class="token operator">=</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br></div></div><h5 id="_6-4-2-3-代码测试运行" tabindex="-1"><a class="header-anchor" href="#_6-4-2-3-代码测试运行" aria-hidden="true">#</a> 6.4.2.3 代码测试运行</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>impala<span class="token punctuation">.</span>impala</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImpalaJdbcClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">Contants</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建一个表</span>
       <span class="token class-name">Contants</span><span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//插入数据</span>
       <span class="token class-name">Contants</span><span class="token punctuation">.</span><span class="token function">insertRows</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;male&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lisi-photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//查询表的数据</span>
        <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> <span class="token class-name">Contants</span><span class="token punctuation">.</span><span class="token function">queryRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Contants</span><span class="token punctuation">.</span><span class="token function">printRows</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//更新数据</span>
        <span class="token class-name">Contants</span><span class="token punctuation">.</span><span class="token function">updateRows</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;male&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;zhangsan-photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//删除数据</span>
        <span class="token class-name">Contants</span><span class="token punctuation">.</span><span class="token function">deleteRows</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//删除表</span>
        <span class="token class-name">Contants</span><span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="_7、kudu原理" tabindex="-1"><a class="header-anchor" href="#_7、kudu原理" aria-hidden="true">#</a> 7、kudu原理</h2><h3 id="_7-1-表与schema" tabindex="-1"><a class="header-anchor" href="#_7-1-表与schema" aria-hidden="true">#</a> 7.1 表与schema</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	Kudu设计是面向结构化存储的，因此，Kudu的表需要用户在建表时定义它的Schema信息，这些Schema信息
包含：列定义（含类型），Primary Key定义（用户指定的若干个列的有序组合）。数据的唯一性，依赖于用户所
提供的Primary Key中的Column组合的值的唯一性。 Kudu提供了Alter命令来增删列，但位于Primary Key中的列是不允许删除的。 Kudu当前并不支持二级索引。 从用户角度来看，Kudu是一种存储结构化数据表的存储系统。
在一个Kudu集群中可以定义任意数量的table，每个table都需要预先定义好schema。每个table的列数是确定的，
每一列都需要有名字和类型，每个表中可以把其中一列或多列定义为主键。这么看来，Kudu更像关系型数据库，
而不是像HBase、Cassandra和MongoDB这些NoSQL数据库。不过Kudu目前还不能像关系型数据一样支持二级索
引。
	Kudu使用确定的列类型，而不是类似于NoSQL的“everything is byte”。这可以带来两点好处： 确定的列类型使Kudu可以进行类型特有的编码。 可以提供 SQL-like 元数据给其他上层查询工具，比如BI工具。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_7-2-kudu的底层数据模型" tabindex="-1"><a class="header-anchor" href="#_7-2-kudu的底层数据模型" aria-hidden="true">#</a> 7.2 kudu的底层数据模型</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Kudu的底层数据文件的存储，未采用HDFS这样的较高抽象层次的分布式文件系统，而是自行开发了一套可基于
Table/Tablet/Replica视图级别的底层存储系统。
这套实现基于如下的几个设计目标：

• 可提供快速的列式查询 
• 可支持快速的随机更新 
• 可提供更为稳定的查询性能保障 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/images/kudu/kudu.jpg" alt=""></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>一张表会分成若干个tablet，每个tablet包括MetaData元信息及若干个RowSet，RowSet包含一个MemRowSet及
若干个DiskRowSet，DiskRowSet中包含一个BloomFile、Ad_hoc Index、BaseData、DeltaMem及若干个
RedoFile和UndoFile（UndoFile一般情况下只有一个）。

MemRowSet：用于新数据insert及已在MemRowSet中的数据的更新，一个MemRowSet写满后会将数据刷到磁盘形成若干个DiskRowSet。每次到达32M生成一个DiskRowSet。

DiskRowSet：用于老数据的变更（mutation），后台定期对DiskRowSet做compaction，以删除没用的数据及合并历史数据，减少查询过程中的IO开销。

BloomFile：根据一个DiskRowSet中的key生成一个bloom filter，用于快速模糊定位某个key是否在DiskRowSet中存在。

Ad_hocIndex：是主键的索引，用于定位key在DiskRowSet中的具体哪个偏移位置。

BaseData是MemRowSet flush下来的数据，按列存储，按主键有序。

UndoFile是基于BaseData之前时间的历史数据，通过在BaseData上apply UndoFile中的记录，可以获得历史数
据。
RedoFile是基于BaseData之后时间的变更（mutation）记录，通过在BaseData上apply RedoFile中的记录，可获得较新的数据。

DeltaMem用于DiskRowSet中数据的变更mutation，先写到内存中，写满后flush到磁盘形成RedoFile。


</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><img src="/images/kudu/rowSets.jpg" alt=""></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>MemRowSets可以对比理解成HBase中的MemStore, 而DiskRowSets可理解成HBase中的HFile。MemRowSets中
的数据按照行试图进行存储，数据结构为B-Tree。
MemRowSets中的数据被Flush到磁盘之后，形成DiskRowSets。 
DisRowSets中的数据，按照32MB大小为单位，按序划分为一个个的DiskRowSet。 DiskRowSet中的数据按照Column进行组织，与Parquet类似。

这是Kudu可支持一些分析性查询的基础。每一个Column的数据被存储在一个相邻的数据区域，而这个数据区域进
一步被细分成一个个的小的Page单元，与HBase File中的Block类似，对每一个Column Page可采用一些Encoding算法，以及一些通用的Compression算法。 既然可对Column Page可采用Encoding以及Compression算法，那么，对单条记录的更改就会比较困难了。
前面提到了Kudu可支持单条记录级别的更新/删除，是如何做到的？
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>与HBase类似，也是通过增加一条新的记录来描述这次更新/删除操作的。DiskRowSet是不可修改了，那么 KUDU 要如何应对数据的更新呢？在KUDU中，把DiskRowSet分为了两部分：base data、delta stores。base data 负责存储基础数据，delta stores负责存储 base data 中的变更数据.

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/images/kudu/2717543-6241f2df6b4dbb47.png" alt=""></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>

如上图所示，数据从 MemRowSet 刷到磁盘后就形成了一份 DiskRowSet（只包含 base data），每份 DiskRowSet 在内存中都会有一个对应的 DeltaMemStore，负责记录此 DiskRowSet 后续的数据变更（更新、删除）。DeltaMemStore 内部维护一个 B-树索引，映射到每个 row_offset 对应的数据变更。DeltaMemStore 数据增长到一定程度后转化成二进制文件存储到磁盘，形成一个 DeltaFile，随着 base data 对应数据的不断变更，DeltaFile 逐渐增长。

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_7-3-tablet的发现过程" tabindex="-1"><a class="header-anchor" href="#_7-3-tablet的发现过程" aria-hidden="true">#</a> 7.3 Tablet的发现过程</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	当创建Kudu客户端时，其会从主服务器上获取tablet位置信息，然后直接与服务于该tablet的服务器进行交谈。
	为了优化读取和写入路径，客户端将保留该信息的本地缓存，以防止他们在每个请求时需要查询主机的tablet位置信息。
	随着时间的推移，客户端的缓存可能会变得过时，并且当写入被发送到不再是tablet领导者的tablet服务器
时，则将被拒绝。然后客户端将通过查询主服务器发现新领导者的位置来更新其缓存。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/images/kudu/kudu-tablet.jpg" alt=""></p><h3 id="_7-4-kudu的写流程" tabindex="-1"><a class="header-anchor" href="#_7-4-kudu的写流程" aria-hidden="true">#</a> 7.4 kudu的写流程</h3><p><img src="/images/kudu/2717543-cfe099f1632ff0dc.png" alt=""></p><pre><code>如上图，当 Client 请求写数据时，先根据主键从Master Server中获取要访问的目标 Tablets，然后到依次对应的Tablet获取数据。
因为KUDU表存在主键约束，所以需要进行主键是否已经存在的判断，这里就涉及到之前说的索引结构对读写的优化了。一个Tablet中存在很多个RowSets，为了提升性能，我们要尽可能地减少要扫描的RowSets数量。
首先，我们先通过每个 RowSet 中记录的主键的（最大最小）范围，过滤掉一批不存在目标主键的RowSets，然后在根据RowSet中的布隆过滤器，过滤掉确定不存在目标主键的 RowSets，最后再通过RowSets中的 B-树索引，精确定位目标主键是否存在。
如果主键已经存在，则报错（主键重复），否则就进行写数据（写 MemRowSet）。
</code></pre><h3 id="_7-5-kudu的读流程" tabindex="-1"><a class="header-anchor" href="#_7-5-kudu的读流程" aria-hidden="true">#</a> 7.5 kudu的读流程</h3><p><img src="/images/kudu/2717543-cbe70fe73014af7d.png" alt=""></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	如上图，数据读取过程大致如下：先根据要扫描数据的主键范围，定位到目标的Tablets，然后读取Tablets 中的RowSets。
	在读取每个RowSet时，先根据主键过滤要scan范围，然后加载范围内的base data，再找到对应的delta stores，应用所有变更，最后union上MemRowSet中的内容，返回数据给Client。

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_7-6-kudu的更新流程" tabindex="-1"><a class="header-anchor" href="#_7-6-kudu的更新流程" aria-hidden="true">#</a> 7.6 kudu的更新流程</h3><p><img src="/images/kudu/2717543-87b1165b0bcc8206.png" alt=""></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	数据更新的核心是定位到待更新数据的位置，这块与写入的时候类似，就不展开了，等定位到具体位置后，然后将变更写到对应的delta store 中。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: qq712679031@qq.com">yangyunhuang</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--]--></div>
    <script type="module" src="/assets/app.f67b6590.js" defer></script>
  </body>
</html>
